<?xml version="1.0"?>
<project xmlns:j="jelly:core" default="astrogrid-install-artifact">

  <!-- standard astrogrid goals -->
  <goal name="astrogrid-build-artifact"   prereqs="jar:jar" />
  <goal name="astrogrid-build-snapshot"   prereqs="jar:snapshot" />
  <goal name="astrogrid-install-snapshot" prereqs="jar:install-snapshot" />
  <goal name="astrogrid-install-artifact" prereqs="jar:install" />
  <goal name="astrogrid-deploy-snapshot"  prereqs="jar:deploy-snapshot" />
  <goal name="astrogrid-deploy-artifact"  prereqs="jar:deploy" />
  <goal name="astrogrid-build-site"       prereqs="site" />
  <goal name="astrogrid-deploy-site"      prereqs="site:deploy" />

  <!--we want to package tests up along with classes in the jar -->
  <preGoal name="jar:jar">
    <attainGoal name="force.compile.tests" />
  </preGoal>

  <goal name="force.compile.tests">
    <j:if test="${maven.test.skip}">
      <echo>Building test classes, although we're skipping the tests</echo>
      <j:set var="maven.test.skip" value="false" />
      <attainGoal name="test:compile" />
      <j:set var="maven.test.skip" value="true" />
    </j:if>
    <echo>Server: Copying test classes into jar from ${maven.build.dir}/test-classes into ${maven.build.dest}</echo>
    <copy todir="${maven.build.dest}">
      <fileset dir="${maven.build.dir}/test-classes">
        <exclude name="log4j.properties" /> <!-- as webapp provides its own -->
      </fileset>
    </copy>
  </goal>	

</project>

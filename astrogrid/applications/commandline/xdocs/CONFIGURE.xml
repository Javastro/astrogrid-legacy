<?xml version="1.0" encoding="ISO-8859-1"?>
<document>
<properties>
        <author email="gtr@ast.cam.ac.uk">Guy Rixon</author>
        <title>Configuration</title>
</properties>

<body>

<section name="Configuration">
	<p>
		You must configure the CL-CEC in two ways:
	</p>
	<ol>
		<li>write a file describing the applications the CL-CEC may run;</li>
		<li>write environment entries into the web container.</li>
	</ol>
	<p>
		The environment entries describe the use of the resource registry,
		directories for scratch files, etc. You can set 
		them using Tomcat's "admin" tool.
	</p>
</section>
	
<section name="Describing the applications">
	<p>
		You must produce an XML file describing to the CL-CEC how to run the applications
		of choice. The XML vocabulary for this file is defined by CEA. The easiest way is
		to copy <a href="CeaApplicationConfig.xml">an example</a> of the file and edit it 
		to suit your site.
	</p>
	<p>
		If you are connecting the same applications as in the example, then the parameter
		lists will probably be the same (you should check that this is really true for your
		installation). You will typically need to change the <i>ExecutionPath</i> elements
		to point to the locations where your applications are installed.
	</p>
	<p>
		Please see the reference document for configuration for a fuller description of the
		application-description language.
	</p>
	<p>
		You may give the application-description file any name you wish and may store it
		on disc in any place that Tomcat can read. You can also store the file on a web server
		if you wish. You will tell Tomcat how to find the
		file by setting one of its environment entries.
	</p>
</section>

	<section name="Environment entries">
		<p>
			You <em>must</em> set the following environment entries as the defaults will not
			be right for your site.
		</p>
		<dl>
			<dt>cea.local.apps.config</dt>
			<dd>The URL for the file describing the local applications to the CL-CEC (see above).</dd>
			<dt>cea.job.records</dt>
			<dd>The absolute path (not a URL) to the directory where the CL-CEC can store 
				records of its jobs.</dd>
			<dt>cea.job.temp.files</dt>
			<dd>The absolute path (not a URL) to a directory where the CL-CEC can store
			temporary files associated with the jobs its runs.</dd>
		</dl>
		
		<p>
			You may need to adjust the following environment entries.
		</p>
		<dl>
			<dt>registry.query.endpoint</dt>
			<dd>The endpoint URL of the registry web-service from which your CL-CEC can read
			back the application registrations. The default is the central registry in
			AstroGrid.</dd>
		</dl>
		
		<p>
			There are some other environment entries defined for the CL-CEC but you should not need
			to change these.
		</p>
		
		<p>
			Please see the 
			<a href="configuration-reference.html">reference document for CL-CEC configuration
			for more details.</a>
		</p>
		
	</section>
	
	<section name="Preserving the configuration">
		<a name="preserve"/>
		<p>
			Upgrades, operator errors and bugs in Tomcat are all likely to destroy your configuration.
			<em>Restoring</em> a configuration from a back-up is easy; <em>reinventing</em> the configuration
			metadata is hard. <em>Take a back-up of your configuration now, and keep it safe, in
			storage that is not connected with Tomcat.</em>
		</p>
		<p>
			Save the environment-entry values by going to the "fingerprint" page
			of the web-application and saving that page. This gives you a 
			human-readable copy of the environment.
		</p>
		<p>
			Save a machine-readable copy of the environment entries by
			copying a file out of Tomcat. The location of the file varies with the
			version and configuration of Tomcat, so you may need to read the Tomcat
			documentation. In Tomcat v5.0.x, in the default configuration of Tomcat, the
			file will be at (Windows)
			<pre>
%CATALINA_HOME%\conf\Catalina\localhost\(context).xml
			</pre>
			or (Unix and Linux)
			<pre>
$CATALINA_HOME/conf/Catalina/localhost/(context).xml
			</pre>
			where the token <i>(context)</i> stands for the 
			name of the web-application context, e.g. CL-CEC-1.
		</p>
		<p>
			Save the application-description file by making a copy outside Tomcat.
			(If the working copy is stored outside Tomcat's directory tree .
		</p>
	</section>
	
	<section name="Restoring a configuration">
		<a name="restore"/>
		<p>Given the configuration back-ups above, you can restore the configuration of the CL-CEC.</p>
		<p>
			Restore the application description by copying the XML file to the location specified in the
			environment entry <i>cea.local.apps.config</i>. This part of the configuration takes effect
			next time the web-application is restarted (e.g. using the "reload" command in Tomcat's
			manager page). A running copy of the CL-CEC will not notice the change in configuration.
	  </p>
		<p>
			Restore the environment entries by one of these methods:
		</p>
		<ul>
			<li>type them in using Tomcat's "admin" tool and the human-readable back-up;</li>
			<li>copy the machine-readable back-up of the environment back into the place in
			Tomcat from which you copied it (see the preservation section, above).</li>
		</ul>
		<p>
			Re-entering the environment through the admin tool makes it available to a running
			CL-CEC at the next restart of the CL-CEC web-application. (Remember to press the
			"commit-changes" button in the admin tool before restarting the web-application.) 
			An environment reloaded by copying the
			file is only available to the CL-CEC after <em>Tomcat</em> itself is restarted.
		</p>
		
	</section>
</body>
</document>

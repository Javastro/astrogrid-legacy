<?xml version="1.0"?>
<!-- extension maven script -->
<project xmlns:j="jelly:core" xmlns:maven="jelly:maven" xmlns:deploy="deploy" default="astrogrid-install-snapshot">
  
  <!-- Before building the WAR, compile the documents.
       The webapp-docs goal is defined in the parent project. -->
  <preGoal name="war:war">
    <attainGoal name="webapp-docs"/>
  </preGoal>

  <!--hook into testing - need to make application executable before unit tests are run -->
  <postGoal name="test:test-resources">
    <j:choose><!--only do this when we're not skipping tests. -->
      <j:when test="${maven.test.skip}" />
      <j:otherwise>
        <echo message="copying across a test application" />
        <copy todir="${maven.war.webapp.dir}/provider/test" overwrite="yes">
          <fileset dir="${basedir}/test/java">
            <include name="app/**" />
          </fileset>
        </copy>
        <chmod perm="+x" file="${basedir}/target/test-classes/app/testapp.sh" />
      </j:otherwise>
    </j:choose>
  </postGoal>

  <!-- redefine goal 'force.compile.tests' - as we don't want it to happen in this project -->
  <goal name="force.compile.tests" />

</project>
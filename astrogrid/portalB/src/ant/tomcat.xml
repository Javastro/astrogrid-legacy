<?xml version="1.0"?>
<!--+
    | <cvs:source>$Source: /Users/pharriso/Work/ag/repo/git/astrogrid-mirror/astrogrid/portalB/src/ant/Attic/tomcat.xml,v $</cvs:source>
    | <cvs:date>$Author: dave $</cvs:date>
    | <cvs:author>$Date: 2003/06/12 18:19:38 $</cvs:author>
    | <cvs:version>$Revision: 1.1 $</cvs:version>
    | <cvs:log>
    | $Log: tomcat.xml,v $
    | Revision 1.1  2003/06/12 18:19:38  dave
    | Initial import into cvs ...
    |
    | </cvs:log>
    |
    +-->
<project default="tomcat.start" basedir=".">

	<!--+
	     | Local user preferences.
	     | Requires 'tomcat.home' set to the Tomcat installation path.
	     | Requires 'JAVA_HOME' environment variable set to the JDK installation path.
	     +-->
	<property file="${user.home}/ant.properties"/>

	<!-- ================ Tomcat tasks ================ -->
	<!--
		Based on the settings from the original Catalina startup script 
		Using CATALINA_BASE:   /usr/java/servers/tomcat/jakarta-tomcat-4.1.18-LE-jdk14
		Using CATALINA_HOME:   /usr/java/servers/tomcat/jakarta-tomcat-4.1.18-LE-jdk14
		Using CATALINA_TMPDIR: /usr/java/servers/tomcat/jakarta-tomcat-4.1.18-LE-jdk14/temp
		Using JAVA_HOME:       /usr/java/j2sdk1.4.1
		Using JAVA_ENDORSED:   /usr/java/servers/tomcat/jakarta-tomcat-4.1.18-LE-jdk14/bin:/usr/java/servers/tomcat/jakarta-tomcat-4.1.18-LE-jdk14/common/endorsed
		Using CLASSPATH:       /usr/java/j2sdk1.4.1/lib/tools.jar:/usr/java/servers/tomcat/jakarta-tomcat-4.1.18-LE-jdk14/bin/bootstrap.jar
		Using JAVA_OPTS:
		Using CATALINA_OPTS:

		exec "$_RUNJAVA" $JAVA_OPTS $CATALINA_OPTS \
		  -Djava.endorsed.dirs="$JAVA_ENDORSED_DIRS" -classpath "$CLASSPATH" \
		  -Dcatalina.base="$CATALINA_BASE" \
		  -Dcatalina.home="$CATALINA_HOME" \
		  -Djava.io.tmpdir="$CATALINA_TMPDIR" \
		  org.apache.catalina.startup.Bootstrap "$@" start
	-->

	<!-- Check that we can find the Tomcat installation -->
	<target name="tomcat.check">
		<fail unless="tomcat.home">
			<![CDATA[
	Property "tomcat.home" is not set.
	Please use the "ant.properties" file to set this to the correct location.
			]]>
		</fail>
		<available property="tomcat.jar-found" file="${tomcat.home}/common/lib/servlet.jar"/>
		<fail unless="tomcat.jar-found">
			<![CDATA[
	Property "tomcat.home" is set but it does not seem to point to the right directory.
	Please use the "ant.properties" file to set this to the correct location.
			]]>
		</fail>
	</target>

	<!-- Generate the Tomcat classpaths -->
	<target name="tomcat.init" depends="tomcat.check">
		<!-- Prefix for system properties -->
		<property environment="env"/>
		<!-- Bootstrap classpath for Tomcat -->
		<path id="tomcat.bootstrap.classpath">
			<pathelement location="${env.JAVA_HOME}/lib/tools.jar"/>
			<pathelement location="${tomcat.home}/bin/bootstrap.jar"/>
		</path>
		<!-- Endorsed libraries for Tomcat -->
		<path id="tomcat.endorsed.classpath">
			<pathelement path="${tomcat.home}/bin"/>
			<pathelement path="${tomcat.home}/common/endorsed"/>
		</path>
		<!-- Build libraries for Tomcat servlets -->
		<path id="tomcat.build.classpath">
			<pathelement location="${tomcat.home}/common/lib/servlet.jar"/>
		</path>

		<!-- Create the config directory -->
		<mkdir dir="build/config"/>
		<!-- Convert the paths to properties -->
		<property name="tomcat.build.classpath" refid="tomcat.build.classpath"/>
		<!-- Save the properties to a file -->
		<propertyfile
			file="build/config/tomcat.properties"
			comment="Tomcat properties">
			<entry key="tomcat.home"            value="${tomcat.home}"/>
			<entry key="tomcat.deploy.path"     value="${tomcat.home}/webapps"/>
			<entry key="tomcat.build.classpath" value="${tomcat.build.classpath}"/>
		</propertyfile>
	</target>

	<!-- Start Tomcat in a separate VM -->
	<target name="tomcat.start" depends="tomcat.init">
		<!-- Start Tomcat in a separate VM -->
		<java taskname="tomcat" classname="org.apache.catalina.startup.Bootstrap" fork="true" dir="${tomcat.home}/bin">
			<!-- Use the bootstrap classpath -->
			<classpath refid="tomcat.bootstrap.classpath"/>
			<!-- These replace the -D command line arguments -->
			<sysproperty key="java.endorsed.dirs" path="${tomcat.endorsed}"/>
			<sysproperty key="catalina.base"      path="${tomcat.home}"/>
			<sysproperty key="catalina.home"      path="${tomcat.home}"/>
			<sysproperty key="java.io.tmpdir"     path="${tomcat.home}/temp"/>
			<!-- Select the server JVM (fails on Linux JDK 1.4.0) -->
			<!-- <jvmarg value="-server"/> -->
			<!-- Args for the Tomcat Bootstrap class -->
			<arg value="start"/>
		</java>
	</target>

	<!-- Stop Tomcat -->
	<target name="tomcat.stop" depends="tomcat.init">
		<!-- Stop Tomcat -->
		<java taskname="tomcat" classname="org.apache.catalina.startup.Bootstrap" fork="true">
			<!-- Use the bootstrap classpath -->
			<classpath refid="tomcat.bootstrap.classpath"/>
			<!-- These replace the -D command line arguments -->
			<sysproperty key="java.endorsed.dirs" path="${tomcat.endorsed}"/>
			<sysproperty key="catalina.base"      path="${tomcat.home}"/>
			<sysproperty key="catalina.home"      path="${tomcat.home}"/>
			<sysproperty key="java.io.tmpdir"     path="${tomcat.home}/temp"/>
			<!-- Select the server JVM (fails on Linux JDK 1.4.0) -->
			<!-- <jvmarg value="-server"/> -->
			<!-- Args for the Tomcat Bootstrap class -->
			<arg value="stop"/>
		</java>
	</target>

	<!-- Clean the Tomcat log files -->
	<!-- Clean the Tomcat work files -->

</project>


AstroGrid Iteration 2 Kit.                                     mySpace system
This document should be displayed with a fixed-pitch (courier) font.
-----------------------------------------------------------------------------

                      Creating a New MySpace Registry
                      ===============================

                               A C Davenhall     
                          Version 1, 29 June 2003


Introduction
------------

The AstroGrid Iteration 2 kit comes with an example mySpace registry
which is ready for use.  However, there may be circumstances in which
you need to create a new mySpace registry, perhaps as part of recovering
an existing mySpace system after some misadventure or perhaps because
you are installing a new mySpace system.  This note describes how to
create a new mySpace registry.

Prior to creating the registry you need to create two files: a
configuration file and an initialisation file.  Both of these files are
simple text files which you create with a text editor.  The installation
kit includes examples of these files which you can use as templates.
Once you have prepared these files you run a utility to create the
registry.

A mySpace system can manage dataHolders (ie. files) held on one or more
geographically dispersed servers.  Similarly it can manage dataHolders
belonging to a defined set of users.  In Iteration 2 new servers and
users can be introduced into a mySpace system only when its registry is
created, and the registry must be created before the mySpace system can
be used.  Thus, in Iteration 2, the users and servers known to a mySpace
system are set when the system is installed and they cannot subsequently
be changed.  This limitation will be addressed in future iterations.

The following sections of this note describe where to find the example
files, discuss some matters about the registry name and describe the
initialisation and configuration files.  The final section presents the
complete procedure to create a new registry.


Example Files
-------------

The installation kit includes an example configuration file and an
example initialisation file.  These files reside in directory:

 .../astrogrid/mySpace/src/java/org/astrogrid/mySpace/mySpaceDemo

The example files are:

  configuration file:   example.config
  initialisation file:  example.initial

You will probably find it convenient to have copies of these files to
hand as you read this note.


The Registry Name and Registry File Names
-----------------------------------------

The very first thing that you need to do when creating a registry is to
decide on its name.  This name will be used as a component of several
Unix file names, so it is sensible to restrict it to contain only
alphanumeric characters and the underscore (`_').  Punctuation
characters, special characters and spaces are all best avoided.  You
will probably use the same name for the registry as for the mySpace
system.

An Iteration 2 mySpace registry comprises three files: the
initialisation and configuration files already mentioned and the
registry file itself.  The names of these files are generated by
appending a file-type to the end of the registry name, as follows:

                         file-type    example
                         ---------    -------
  configuration file;    .config      example.config
  initialisation file:   .initial     example.initial
  registry file:         .reg         example.reg

Thus, the example configuration and initialisation files included in the
Iteration 2 kit are for a registry called `example'.


The Configuration File
----------------------

See file: example.config

The configuration file specifies a few configuration parameters for the
mySpace system.  The format of this file is quite flexible.  Comment and
blank lines may be freely included as required, and their use to improve
readability is encouraged.  Comments begin with a `#' character and
continue for the rest of the line.

Parameters are identified by a parameter name, which should be the
first item to occur on a line.  Parameter names are case sensitive
and must be specified precisely.  The remainder of the line gives
details of the parameter.  The items on a line should be separated by
one or more spaces.  Parameters can occur in any order in the file.  In
Iteration 2 two parameters are supported:

expiryperiod
  The expiry period in days.  This parameter is optional and if it is
  omitted a default of 30 days is adopted.  Note that the automatic
  expiry of dataHolders is not supported in Iteration 2 and so this
  parameter is not used.

server
  This parameter specifies the details of one of the servers managed
  by the mySpace system.  Three items are required for each server,
  as follows and in the following order:

  * the name of the server (as it will appear in listings of containers
    and dataholders),

  * a URL corresponding to the directory on the server which holds
    the data files,

  * the actual file name of the directory on the server containing
    the data files.

  A mySpace system can manage an arbitrary number of servers and the
  configuration file must contain an entry for every server in the
  system.  At least one server entry must be present.  Obviously, the
  names of the servers must be distinct.


The Initialisation File
-----------------------

See file: example.initial

The initialisation file defines the users known to the mySpace system
and the servers on which each user has been assigned disk space.
Note that in Iteration 2 these details are set when the registry is
created and they cannot subsequently be changed.

The initialisation file consists of a list of container names.  These
containers are the top two levels of the container hierarchy.
The top-level corresponds to all the users known to the system and the
second-level to servers on which each user has been assigned disk
space.

The format of the file is quite strict:

* the container names occur one per line,

* blank lines, leading spaces and comments are not permitted,

* the top-level container for a user should occur before the second-level
  containers corresponding to the servers where the user has disk space.

Note that every container name starts with a leading `/' character.  Also
note that the names of the server containers correspond to the servers
listed in the configuration file.


The Procedure to Create a New Registry
--------------------------------------

The procedure to create a new registry is as follows.

1. Choose a name for the registry; it will probably be the name of your
   mySpace system.

2. Create appropriate configuration and initialisation files.  The
   formats of these files were described in previous sections.  The
   example files included with the Iteration 2 kit can be used as
   templates.

   Remember that installation is the only time when you can define the
   users and servers known to the mySpace system.

3. Create the registry by running the CreateRegistry utility, which
   resides in directory:

    .../astrogrid/mySpace/src/java/org/astrogrid/mySpace/mySpaceDemo

   Set an appropriate CLASSPATH and then:

     java CreateRegistry registry-name

   for example, with the example files:

     java CreateRegistry example

   Note that the CreateRegistry utility requires the name of the
   registry, not the name of the configuration or initialisation file.

4. You can check that the registry was created successfully by using
   the ListRegistry utility (which resides in the same directory as
   CreateRegistry):

     java ListRegistry registry-name

   for example, with the example files:

     java ListRegistry example

   Again it is the name of the registry which must be supplied.  The
   contents of the registry will be listed to standard output.  The
   initial contents will simply be the containers corresponding to the
   users in your registry and the servers on which they have been
   assigned space.  The order in which the entries are listed is random.

   Note that the ListRegistry utility can be run at any time, not just
   immediately after the creation of the registry.
  

Revision History
----------------

Version 1, 29/6/03: Original version (ACD). 


-----------------------------------------------------------------------------
AstroGrid Iteration 2 Kit.                                     mySpace system

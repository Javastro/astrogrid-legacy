<?xml version="1.0" ?>

<!-- extension maven script -->
<project xmlns:j="jelly:core"  
         xmlns:maven="jelly:maven" 
         xmlns:ant="jelly:ant" 
         default="jar:jar">

  <!-- Clean the sub-project when the parent project is cleaned. -->
  <preGoal name="clean:clean">
    <attainGoal name="multiproject:clean"/>
  </preGoal>

  <!-- This causes the executable jar to be built in the
       ogsadai sub-project.  The "multiproject:artifact" goal
       activates the goal in each subproject that builds that
       sub-project's principal artifact (as defined by the
       maven.multiproject,type property in the sub-project). -->
  <preGoal name="war:init">
    <attainGoal name="multiproject:artifact"/>
  </preGoal>
  
  <!-- Build the web apges for the sub-project when the main site is built. -->
  <preGoal name="site:generate">
    <attainGoal name="multiproject:site"/>
  </preGoal>

  <!-- This file is for local adjustments.  -->
  <property file="config/build.properties"/>
   
  <!-- This file specializes this template to a particular product. -->
  <property file="config/template.properties"/>
   
  <!-- Deploy the webservice into tomcat. -->
  <target name="deployToTomcat">
    <path id="classpath">
      <path refid="maven.dependency.classpath"/>
    </path>
    <echo message="Deploying webservice to tomcat at ${tomcat.home}..." />
    <copy toDir="${tomcat.home}/webapps/axis/WEB-INF/classes">
      <fileset dir="target/classes">
        <include name="**/*.class"/> 
        <include name="**/*.properties"/> 
      </fileset>
    </copy>
    <java classname="org.apache.axis.utils.Admin" 
          classpathref="classpath"
          dir="${tomcat.home}/webapps/axis/WEB-INF"
          fork="yes" failonerror="true">
      <arg value="server"/>
      <arg value="${basedir}/wsdd/deploy.wsdd"/>
    </java>
  </target>
             
  <!-- Undeploy the webservice from tomcat. -->
  <target name="undeployFromTomcat">
    <echo message="Undeploying webservice from tomcat at ${tomcat.home}..." />
    <path id="classpath">
      <path refid="maven.dependency.classpath"/>
    </path>
    <java classname="org.apache.axis.utils.Admin"
          dir="${tomcat.home}/webapps/axis/WEB-INF"
          classpathref="classpath" fork="yes" failonerror="true">
      <arg value="server"/>
      <arg value="${basedir}/wsdd/undeploy.wsdd"/>
    </java>
    <delete dir=
      "${tomcat.home}/webapps/axis/WEB-INF/classes/org/astrogrid/warehouse"/>
   </target>

  <!-- THIS PUTS ITS VOTABLE OUTPUT IN /tmp/QUERIER_OUTPUT_VOT -->
   <target name="querierTest">
     <path id="classpath">
       <pathelement location="target/classes"/>
       <path refid="maven.dependency.classpath"/>
     </path>
      <java classname="org.astrogrid.warehouse.queriers.ogsadai.WarehouseQuerier"
            dir="target/classes" fork="yes" failonerror="true"
            classpathref="classpath">
        <arg value= "SELECT * FROM first WHERE POS_EQ_DEC > 59.9"/>
        <arg value= "/tmp/QUERIER_OUTPUT_VOT"/>
      </java>
   </target>

   <target name="datacenterTest">
     <path id="classpath">
       <pathelement location="target/classes"/>
       <path refid="maven.dependency.classpath"/>
     </path>
      <java classname="org.astrogrid.datacenter.tools.SimpleQuerier"
            dir="target/classes" fork="yes" failonerror="true"
            classpathref="classpath">
        <arg value="http://cass123.ast.cam.ac.uk:4040/pal-SNAPSHOT/services/AxisDataServer"/>
        <arg value= "/data/cass123a/kea/DEVEL/astrogrid/warehouse/myquery"/>
      </java>
   </target>

   <!-- TEMPORARY TEST HARNESS -TOFIX REMOVE -->
   <target name="tempTest">
     <path id="classpath">
       <path refid="maven.dependency.classpath"/>
     </path>
      <java classname="org.astrogrid.warehouse.delegate.WebDelegate"
            dir="target/classes" fork="yes" failonerror="true">
        <arg value=
            "${tomcat.host}/axis/services/WarehouseServiceIfc"/>
      </java>
   </target>

</project>

<?xml version="1.0"?>
<!-- extension maven script -->
<project xmlns:j="jelly:core" xmlns:maven="jelly:maven" xmlns:ant="jelly:ant" xmlns:deploy="deploy">
<postGoal name="build:start">
        <j:set var="groovyVersion" value="${pom.dependencies.0.version}" /><!-- position dependent for now..-->
        <echo>Packaging with Groovy ${groovyVersion}</echo>
</postGoal>

<!-- parent project adds this hook now.. <postGoal name="dist:prepare-bin-filesystem"> -->
<goal name="packageit">
        <ant:delete file="${maven.dist.bin.assembly.dir}/astrogrid-scripting-groovy-SNAPSHOT.jar" />
        <deploy:copy-deps todir="${maven.dist.bin.assembly.dir}/lib" />
        <ant:copy todir="${maven.dist.bin.assembly.dir}">
                <fileset dir="${basedir}">
                        <include name="bin/**" />
                        <include name="groovy-lib/**" />
                        <include name="examples/**" />
                </fileset>
        </ant:copy>
        <!-- unpackage and copy in groovy -->
        <ant:untar dest="${basedir}/target/" compression="gzip"
                src="${maven.dist.bin.assembly.dir}/lib/groovy-${groovyVersion}.tar.gz"
        />
        <ant:delete file="${maven.dist.bin.assembly.dir}/lib/groovy-${groovyVersion}.tar.gz" />
        <ant:copy todir="${maven.dist.bin.assembly.dir}">
                <fileset dir="${basedir}/target/groovy-${groovyVersion}">
                        <exclude name="docs/**" /> <!-- don't want it mixing with original docs.-->
                </fileset>
        </ant:copy>
        <ant:copy todir="${maven.dist.bin.assembly.dir}/groovy-docs">
                <fileset dir="${basedir}/target/groovy-${groovyVersion}/docs" />
        </ant:copy>
</goal>

<!-- for my own use -->
<goal name="install-groovy">
        <ant:property name="install.dir" location="/home/noel/java/" />
        <ant:delete quiet="true">
                <fileset dir="${install.dir}/astrogrid-scripting-groovy-SNAPSHOT" />
        </ant:delete>
        <ant:unzip src="${basedir}/target/distributions/astrogrid-scripting-groovy-SNAPSHOT.zip" dest="${install.dir}" overwrite="true" />
        <ant:chmod dir="${install.dir}/astrogrid-scripting-groovy-SNAPSHOT/bin" perm="a+rx" includes="**/*" />
</goal>

</project>

<?xml version="1.0"?>
<!--+
    | <cvs:source>$Source: /Users/pharriso/Work/ag/repo/git/astrogrid-mirror/astrogrid/portal/login/site/sitemap.xmap,v $</cvs:source>
    | <cvs:author>$Author: jdt $</cvs:author>
    | <cvs:date>$Date: 2004/03/24 18:31:33 $</cvs:date>
    | <cvs:version>$Revision: 1.13 $</cvs:version>
    +-->
<map:sitemap xmlns:map="http://apache.org/cocoon/sitemap/1.0">
<!-- ======================== Components ================================ -->
   <map:components>
      <map:generators default="file" />

      <map:transformers default="xslt" />

      <map:readers default="resource" />

      <map:serializers default="html" />

      <map:selectors default="browser" />

      <map:selector name="parameter" logger="sitemap.selector.parameter" src="org.apache.cocoon.selection.ParameterSelector" />

      <map:matchers default="wildcard" />

      <map:actions>
         <map:action name="astro-login" src="org.astrogrid.portal.cocoon.common.LoginAction" logger="astrogrid.action.astro-login"/>
         <map:action name="astro-message-admin" src="org.astrogrid.portal.cocoon.common.MessageToAdminAction" logger="astrogrid.action.astro-message-admin"/>
      </map:actions>
   </map:components>

<!-- =========================== Views =================================== -->
<!--+
        | Views for debugging XSL transforms
        +-->
   <map:views>
<!-- Original XML displayed as XML -->
      <map:view name="000" from-label="000">
         <map:serialize type="xml" />
      </map:view>

<!-- Original XML, displayed as XML/HTML -->
      <map:view name="001" from-label="001">
<!-- Convert into XML/HTML -->
         <map:transform src="web/style/xsl/xml-html.xsl" />

         <map:serialize type="html" />
      </map:view>

<!-- XML processed into a page, displayed as XML/HTML -->
      <map:view name="002" from-label="002">
<!-- Convert into XML/HTML -->
         <map:transform src="web/style/xsl/xml-html.xsl" />

         <map:serialize type="html" />
      </map:view>

<!-- Page wrapped in our template, displayed as XML/HTML -->
      <map:view name="003" from-label="003">
<!-- Convert into XML/HTML -->
         <map:transform src="web/style/xsl/xml-html.xsl" />

         <map:serialize type="html" />
      </map:view>
   </map:views>

<!-- ========================== Resources ================================= -->
   <map:resources>
   </map:resources>

<!-- ========================== Pipelines ================================= -->
   <map:pipelines>
   <!--+
       | Main pipeline.
       +-->
      <map:pipeline>
      <!-- Login page -->
         <map:match pattern="login-form">
         <!--+
             | If we are not logged in, display the login form.
             +-->
            <map:act type="form-validator">
               <map:parameter name="descriptor" value="cocoon:/defs/logon-def.xml" />
               <map:parameter name="validate-set" value="login" />
               <!--validation succeeded-->
               <map:act type="astro-login">
                  <!--login successful-->
                  <map:generate type="serverpages" src="xsp/login-pass.xsp" />
                  <map:transform type="xslt" src="style/info.xsl" />
                  <map:serialize type="xml" />
               </map:act>
               <!-- login unsuccessful -->
               <map:generate type="file" src="xml/login-failed.xml"/>
               <map:transform type="xslt" src="style/info.xsl" />
               <map:serialize type="xml" />
            </map:act>
            <!--if the validation fails (or it's first time thru) -->
            <map:generate type="serverpages" src="xsp/logon.xsp"/>
            <map:transform type="xslt" src="style/logon.xsl" />
            <map:serialize type="xml" />
         </map:match>
         
         <!-- New Logout page -->
         <map:match pattern="logout">
            <map:generate type="serverpages" src="xsp/logout.xsp"/>
            <map:transform type="xslt" src="style/info.xsl" />
            <map:serialize type="xml" />
         </map:match>
				 
         <!-- Register page -->
         <map:match pattern="register">
         <!--+
             | If we are not registered, display the register form.
             +-->
            <map:act type="form-validator">
               <map:parameter name="descriptor" value="cocoon:/defs/logon-def.xml" />
               <map:parameter name="validate-set" value="register" />
               <!--validation succeeded-->
               <map:act type="astro-message-admin">
                  <map:parameter name="subject" value="Registration Request" />
                  <map:parameter name="message" value="A new user has requested registration.  Details below." />
                  <!--Registration successful-->
                   <map:generate type="file" src="xml/registered.xml" />
                   <map:transform type="xslt" src="style/info.xsl" />
                   <map:serialize type="xml" />
               </map:act>
               <!-- Registration unsuccessful -->
               <map:generate type="file" src="xml/failed.xml" />
               <map:transform type="xslt" src="style/info.xsl" />
               <map:serialize type="xml" />
            </map:act>
            <!--if the validation fails (or it's first time thru) -->
            <map:generate type="serverpages" src="xsp/register.xsp"/>
            <map:transform type="xslt" src="style/logon.xsl" />
            <map:serialize type="xml" />
         </map:match>
				 
				 <!-- Reminder page -->
         <map:match pattern="reminder">
         <!--+
             | If we are not registered, display the register form.
             +-->
            <map:act type="form-validator">
               <map:parameter name="descriptor" value="cocoon:/defs/logon-def.xml" />
               <map:parameter name="validate" value="email" />
               <!--validation succeeded-->
               <map:act type="astro-message-admin">
                  <map:parameter name="subject" value="Reminder Request" />
                  <map:parameter name="message" value="A user has requested password reminder.  Details below." />
 
                  <!--Reminder successful-->
                   <map:generate type="file" src="xml/reminderrequested.xml" />
                   <map:transform type="xslt" src="style/info.xsl" />
                   <map:serialize type="xml" />
               </map:act>
               <!-- Reminder unsuccessful -->
               <map:generate type="file" src="xml/failed.xml" />
               <map:transform type="xslt" src="style/info.xsl" />
               <map:serialize type="xml" />
              </map:act>
            <!--if the validation fails (or it's first time thru) -->
            <map:generate type="serverpages" src="xsp/reminder.xsp"/>
            <map:transform type="xslt" src="style/logon.xsl" />
            <map:serialize type="xml" />
         </map:match>

         <map:match pattern="**/*.xml">
            <map:generate type="file" src="{1}/{2}.xml" />
            <map:serialize type="xml" />
         </map:match>

         <map:match pattern="*.xsl">
            <map:generate type="file" src="style/{1}.xsl" />
            <map:serialize type="xml" />
         </map:match>

         <map:match pattern="login-oops">
            <map:generate type="serverpages" src="xsp/logon.xsp" label="000" />
            <map:transform type="xslt" src="style/logon.xsl" />
            <map:serialize type="xml" />
         </map:match>
      </map:pipeline>
   </map:pipelines>
</map:sitemap>

<!--+
    | <cvs:log>
    |   $Log: sitemap.xmap,v $
    |   Revision 1.13  2004/03/24 18:31:33  jdt
    |   Merge from PLGN_JDT_bz#201
    |
    |   Revision 1.12.2.3  2004/03/24 18:15:44  jdt
    |   XSP now used when user logs in so that they can be greeted 
    |   by name.
    |
    |   Revision 1.12  2004/03/19 14:13:00  jdt
    |   Merge from PLGN_JDT_bz199b.
    |   Added log out page.
    |
    |   Revision 1.11  2004/03/19 13:09:03  jdt
    |   references to login-jdt -> login-form
    |   ie, new page is now live.
    |
    |   Revision 1.10  2004/03/19 13:02:25  jdt
    |   Pruned the log messages - they cause conflicts on merge, 
    |   best just to reduce them to the merge message.
    |
    |   Revision 1.9  2004/03/19 12:40:09  jdt
    |   Merge from PLGN_JDT_bz199b.
    |   Refactored log in pages to use xsp and xsl style sheets.  
    |   Added pages for requesting a login, and requesting
    |   a password reminder.
    |
    | </cvs:log>
    |
    +-->


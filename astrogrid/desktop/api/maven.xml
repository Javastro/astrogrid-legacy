<?xml version="1.0"?>
<!-- extension maven script -->
<project   xmlns:j="jelly:core" xmlns:maven="jelly:maven" >

	<goal name="astrogrid-install-artifact" prereqs="jar:install,dist:build-bin,javahelp-install">
		<echo>No goal exists to install a distro - so have built and just left it in target dir</echo>
	</goal>


	<goal name="astrogrid-deploy-artifact" prereqs="jar:deploy,dist:deploy-bin,javahelp-deploy">
	</goal>

	<goal name="astrogrid-build-artifact" prereqs="jar:jar,dist:build-bin,javahelp-jar">
	</goal>
	
	<goal name="astrogrid-clean" prereqs="clean,javahelp-clean" />

	<!-- add in dependent jars -->
	<postGoal name="dist:prepare-bin-filesystem">
		<j:forEach var="lib" items="${pom.artifacts}">
			<j:set var="dep" value="${lib.dependency}"/>			
			<j:if test="${dep.getProperty('dist.bundle')=='true'}">
				<j:choose>
					<copy todir="${maven.dist.bin.assembly.dir}" 
					      file="${lib.path}"/>			
				</j:choose>
			</j:if>
                </j:forEach>		
	</postGoal>
	
	<preGoal name="xdoc:jelly-transform">
		<attainGoal name="xmlrpcdoc"/>
	</preGoal>
	
	<goal name="javahelp-install">
		<maven:maven goals="jar:install" descriptor="javahelp/project.xml" />
	</goal>
	<goal name="javahelp-deploy">
		<maven:maven goals="jar:deploy" descriptor="javahelp/project.xml" />
	</goal>
	<goal name="javahelp-jar">
		<maven:maven goals="jar:jar" descriptor="javahelp/project.xml" />
	</goal>	
	<goal name="javahelp-clean">
		<maven:maven goals="clean:clean" descriptor="javahelp/project.xml" />
	</goal>
	
	<goal name="xmlrpcdoc">		
		<j:set var="maven.javadoc.doclet" value="com.jeldoclet.JELDoclet" />
		<mkdir dir="${basedir}/target/xmlrpcdoc" />
		<j:set var="maven.javadoc.additionalparam" value="-d ${basedir}/target/xmlrpcdoc" />
		<j:set var="maven.javadoc.docletpath" value="${pom.getDependencyPath('jeldoclet')}" />
		<attainGoal name="javadoc" />
		<!-- hack from mailing list to fix Maven XLST bug -->
		${systemScope.setProperty('javax.xml.transform.TransformerFactory','org.apache.xalan.processor.TransformerFactoryImpl')}
				
		<xslt style="${basedir}/xmlrpcdoc.xsl" 
		      in="${basedir}/target/xmlrpcdoc/jel.xml"
		      out="${basedir}/target/generated-xdocs/xmlrpc.xml" 
		      force="true"
		      >
			<outputproperty name="method" value="xml"/>			
			<outputproperty name="standalone" value="yes"/>
  			<outputproperty name="indent" value="yes"/>
		</xslt>
	</goal>
	
</project>


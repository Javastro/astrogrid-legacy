<?xml version="1.0"?>
<!DOCTYPE module  [
	<!ENTITY descriptors SYSTEM "classpath:/org/astrogrid/desktop/hivemind/plastic-descriptors.xml">
	]>
<module id="plastic" version="1.0.0" package="org.votech.plastic">
	PLASTIC - PLatform for AStronomical Tools Inter Connection
	<dependency module-id="system"/>
	
	<contribution configuration-id="framework.acrServices">
			<acrService id="hub" interface="PlasticHubListener" />
	</contribution>
		
	<contribution configuration-id="framework.descriptors">
		<acr-module name="plastic" description="PLatform for AStronomical Tools Inter Connection">
		&descriptors;
		</acr-module>
	</contribution>
	
	<!--  start hub when program runs. -->
	<contribution configuration-id="hivemind.EagerLoad">
		<load service-id="hub"/> 
	</contribution>



	<!-- ========================
	HUB
	 -->
	
	<service-point id="hub" interface="org.astrogrid.desktop.modules.plastic.PlasticHubListenerInternal">
		Plastic hub
        <interceptor service-id="system.edt" >
            <exclude method="get*" />
            <exclude method="set*" />
        </interceptor>   
		<interceptor service-id="system.throbber" />		
		<invoke-factory>
			<construct class="org.astrogrid.desktop.modules.plastic.PlasticHubImpl"
				initialize-method="start">
				<event-listener service-id="builtin.shutdown" />					
                <string>${astrogrid.desktop.version}</string>
				<service>system.ui</service>
                <service>system.executor</service>
				<service>namegen</service>
				<service>system.rmi</service>
				<service>system.webserver</service>
				<service>system.systray</service>	
				<service>prettyPrinter</service>
				<object>preference:org.votech.plastic.notificationsenabled</object>	
			</construct>
		</invoke-factory>
	</service-point>

	<implementation service-id="hub" if="property plastic.hub.disabled">
		<invoke-factory service-id="hivemind.lib.PlaceholderFactory" />	
	</implementation>	
			
	<contribution configuration-id="system.rmiListenerInterfaces">
		<service id="hub">
			<listener interface="org.votech.plastic.PlasticListener" />
		</service>
	</contribution>
	
	<contribution configuration-id="framework.preferences">
		<preference name="org.votech.plastic.notificationsenabled"
			default-value="true">
			<ui-name>Display plastic events</ui-name>
			<description>Show plastic event notifications in the system tray</description>
			<units>boolean</units>
		</preference>
	</contribution>
	
	<!-- supporting service -->
	<!-- 
	NAME GENERATOR
	 -->
	<service-point id="namegen" visibility="private" interface="org.astrogrid.common.namegen.NameGen">
		Unique name generator
		<create-instance model="primitive" class="org.astrogrid.common.namegen.InMemoryNameGen" />
	</service-point>
	<!-- 
	PRETTY PRINTER
	 -->
	<service-point id="prettyPrinter" visibility="private" interface="org.astrogrid.desktop.modules.plastic.PrettyPrinterInternal">
		Pretty printer component.
		<invoke-factory>
			<construct class="org.astrogrid.desktop.modules.plastic.PrettyPrinterImpl" >
				<service>system.browser</service>
			</construct>
		</invoke-factory>	
	</service-point>	
	
	<!--  
	
	implementations required only when in hub mode
	================================

-->
	
	<!-- simple session manager, which doesn't use AG machinery, or single sign on. -->
	<implementation service-id="builtin.sessionManager" if="property hub.mode">
		<invoke-factory>
			<construct	class="org.astrogrid.desktop.alternatives.SingleSessionManager" >
				<service>hivelock.core.SecurityService</service>
				<service>system.webserver</service>
			</construct>
		</invoke-factory>
	</implementation>		
	
	<!-- just stub this one out - not needed in hub mode. -->
	<implementation service-id="hivelock.core.PrincipalHelper" if="property hub.mode">
		<invoke-factory service-id="hivemind.lib.PlaceholderFactory" />	
	</implementation>		
	
	
 </module>
 
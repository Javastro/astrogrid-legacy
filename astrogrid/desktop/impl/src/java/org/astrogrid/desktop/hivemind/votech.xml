<?xml version="1.0"?>
<!DOCTYPE module  [
	<!ENTITY descriptors SYSTEM "classpath:/org/astrogrid/desktop/hivemind/votech-descriptors.xml">
	]>
<module id="votech" version="1.0.0" package="org.votech">
<!--  PREAMBLE -->
	<contribution configuration-id="framework.descriptors">
		<acr-module name="votech" description="Services and infrastructure developed as part of the VOTech project">
		&descriptors;
		</acr-module>
	</contribution>	
		
	<contribution configuration-id="framework.acrServices">
			<acrService id="vomon" interface="VoMon" />
	</contribution>
	



	
	<!-- services and implementations -->
<!-- 
=============================================
VOMON
 -->	
	<service-point id="vomon" interface="org.astrogrid.desktop.modules.votech.VoMonInternal">
		Service Monitor		
		<invoke-factory>
			<construct class="org.astrogrid.desktop.modules.votech.VoMonImpl" >
			<string>${votech.vomon.endpoint}</string><!--  endpoint to fetch vomon status.xml from -->
			<int>${votech.vomon.reload}</int><!--  period between refreshes of the status.xml (seconds) -->
			<object>cache:vomon</object>
			<service>system.ui</service>
			</construct>
		</invoke-factory>	
	</service-point>

	<contribution configuration-id="ivoa.caches">
		cache of service status.
		'unlimited' disk storage for entire document
		<cache name="vomon"
			maxElementsInMemory="100"
			maxElementsOnDisk="10000"
			overflowToDisk="true"
			diskPersistent="false"
			timeToLiveSeconds="7200"
			timeToIdleSeconds="7200"
		/>
	</contribution>

	<implementation service-id="vomon" if="property votech.vomon.disabled">
		<invoke-factory service-id="hivemind.lib.PlaceholderFactory" />	
	</implementation>	
	
	<contribution configuration-id="framework.preferences">
		<preference name="votech.vomon.endpoint" 
			requires-restart="true" advanced="true"
			default-value="http://vomon.astrogrid.org/status.xml" >
			<ui-name>Monitoring endpoint</ui-name>
			<description>A http url that returns a vomon xml document</description>
			<alternative>http://vomon.roe.ac.uk/status.xml</alternative>
			<units>url</units>
		</preference>
		<preference name="votech.vomon.reload" 
			requires-restart="true"
			default-value="3600" > <!--  hourly -->
				<ui-name>Refresh monitor every</ui-name>
				<units>seconds</units>
				<description>Period between reloading the monitoring information</description>
			</preference>
	</contribution>

	<!--  load on startup -->
	<contribution configuration-id="hivemind.EagerLoad">
		<load service-id="vomon"/><!--  fetches status fiule from service on startup. -->
	</contribution>	
	
	<contribution configuration-id="system.scheduledTasks">
		<object>service:vomon</object><!--  reloads the data periodically -->
	</contribution>

 </module>
 
<?xml version="1.0"?>
<!DOCTYPE module  [
	<!ENTITY descriptors SYSTEM "classpath:/org/astrogrid/desktop/hivemind/ui-descriptors.xml">
	]>
<module id="ui" version="1.0.0" package="org.astrogrid.acr.ui">
	<dependency module-id="system"/>
	<dependency module-id="astrogrid" />
	<dependency module-id="dialogs" />
	<dependency module-id="ivoa" />
	<dependency module-id="nvo" />
	<dependency module-id="cds" />
	<dependency module-id="plastic" />				
		
	<!-- new configurations -->
	<configuration-point id="workflowTemplates">
		Lists available parameterized workflows
		<schema>
			<element name="workflow-template">
				Gives the url of a workflow template.
				<rules>
					<push-content />
					<invoke-parent method="addElement" />
				</rules>
			</element>
		</schema>
	</configuration-point>.
	
	
	
	<!-- contributions to existing configurations -->
	<contribution configuration-id="workflowTemplates">
		<workflow-template>http://wiki.astrogrid.org/pub/Astrogrid/ParameterizedWorkflows/timemovimakernew.wf</workflow-template>
		<workflow-template>http://wiki.astrogrid.org/pub/Astrogrid/ParameterizedWorkflows/redshiftmaker.xml</workflow-template>
		<workflow-template>http://wiki.astrogrid.org/pub/Astrogrid/ParameterizedWorkflows/redshiftmakerng.xml</workflow-template>
		<workflow-template>http://www.merlin.ac.uk/astrogrid/colourcutter.xml</workflow-template>
		<workflow-template>http://wiki.astrogrid.org/pub/Astrogrid/ParameterizedWorkflows/ctipmodeA.xml</workflow-template>
		<workflow-template>http://wiki.astrogrid.org/pub/Astrogrid/ParameterizedWorkflows/sdss-dr3.xml</workflow-template>		
	</contribution>
	
	<contribution configuration-id="framework.descriptors">
		<acr-module name="ui" description="Applications for working with the VO">
		&descriptors;
		</acr-module>
	</contribution>	
		
	<contribution configuration-id="framework.acrServices">
			<acrService id="astroscope" interface="AstroScope"/>
			<acrService id="helioscope" interface="HelioScope"/>
			<acrService id="lookout" interface="Lookout" />
			<acrService id="parameterizedWorkflows" interface="ParameterizedWorkflowLauncher" />
			<acrService id="applicationLauncher" interface="ApplicationLauncher" />
			<acrService id="workflowBuilder" interface="WorkflowBuilder" />
			<acrService id="myspaceBrowser" interface="MyspaceBrowser" />
			<acrService id="jobMonitor" interface="JobMonitor" />
			<acrService id="registryBrowser" interface="RegistryBrowser" />
	</contribution>

<!-- assume that if this module is loaded, we're running as workbench -->
	<contribution configuration-id="system.uiStructure">
		<tab name="apps" text="Applications" before="*" />
		<action parentName="help" name="about" text="About AstroGrid Workbench.."
			object="instance:java.lang.String" methodName="concat" iconName="AGlogo16x16.png"
			after="*" > 
			<parameter><![CDATA[
			<html>
			<h1>Astrogrid Workbench v${workbench.version}</h1>			
			<b>http://software.astrogrid.org</b><br>
			TODO - fill this in
			<h2>Development</h2
			<ul>
			<li>Kevin Benson</li>
			<li>Jeff Lusted</li>
			<li>Phil Nicholson</li>
			<li>Catherine Qin</li>
			<li>Guy Rixon</li>
			<li>John Taylor</li>
			<li>Noel Winstanley</li>
			</ul>			
			<h2>Acknowledgements</h2>
			CDS, Plastic, NVO services, blah blah.
			
			<h2>Copyright</h2>
			link..
			</html>
			]]></parameter>
		</action>	
	</contribution>

	<contribution configuration-id="system.uiStructure" if="not (property ui.astroscope.disabled)" >
		<action parentName="apps" name="astroscope" text="AstroScope" before="*" iconName="astroscope.png"
			object="service:astroscope" methodName="show">
			<tooltip><![CDATA[
				<html>Search and visualise matches in all <br>
					available image, catalogue and  spectral archives by <br>
					offset from user defined sky position and radius.
					]]></tooltip>
		  </action>
	</contribution>
	
	<contribution configuration-id="system.uiStructure" if="not (property ui.helioscope.disabled)" >	
		<action parentName="apps" name="helioscope" text="HelioScope" after="astroscope" iconName="helioscope.png"
			object="service:helioscope" methodName="show">
			<tooltip><![CDATA[
			<html>Search and visualise matches in all <br>
					available solar archives by<br>
					offset from user defined start and end times
			]]></tooltip>			
		</action>
	</contribution>
	
	
	<contribution configuration-id="system.uiStructure" if="not (property ui.applicationLauncher.disabled)" >	
		<action parentName="apps" name="applicationLauncher" text="Launch" iconName="applaunch.png"
			object="service:applicationLauncher" methodName="show" after="astroscope">
			<tooltip><![CDATA[
		<html>Launches a single task to be executed on the AstroGrid system.<br>
	A task can be either a Query to a data centre or a noninteractive<br>
	Application that, e.g. operates on data files or runs a model.
			]]></tooltip>			
			</action>			
	</contribution>	

	<contribution configuration-id="system.uiStructure" if="not (property ui.parameterizedWorkflows.disabled)" >	
		<action parentName="apps" name="parameterizedWorkflows" text="Parameterized Workflows" iconName="logo48x48.png"
			object="service:parameterizedWorkflows" methodName="run" after="astroscope,applicationLauncher">
			<tooltip><![CDATA[
		<html>Direct access and editing of pre-canned workflows <br>
			for commonly required astronomical tasks.			
			]]></tooltip>
		</action>
	</contribution>		
		
		<contribution configuration-id="system.uiStructure" if="not (property ui.workflowBuilder.disabled)" >	
		<action parentName="apps" name="workflowBuilder" text="Workflow" iconName="workflow.png"
			after="parameterizedWorkflows" 
			object="service:workflowBuilder" methodName="show" >
			<tooltip><![CDATA[
			<html>Interactive GUI workflow builder for sequencing tasks and queries to<br>
			AstroGrid and other VO services.
			]]></tooltip>
		</action>
	</contribution>	

	<contribution configuration-id="system.uiStructure" if="not (property ui.lookout.disabled)" >	
		<action parentName="apps" name="lookout" text="Lookout" iconName="lookout.png"
			after="astroscope,applicationLauncher,workflowBuilder" 
			object="service:lookout" methodName="show" >
			<tooltip><![CDATA[
		<html>Monitor the progress of Tasks, Queries and Workflows submitted for<br>
		execution on the AstroGrid system including links to job transcripts.						
			]]></tooltip>
		</action>					
	</contribution>		
		
		<contribution configuration-id="system.uiStructure" if="not (property ui.myspaceBrowser.disabled)" >	
		<action parentName="apps" name="myspaceBrowser" text="Myspace" iconName="myspace.png"
			object="service:myspaceBrowser" methodName="show" after="lookout" >			
			<tooltip><![CDATA[
			<html>Login to MySpace for browsing and utilisation of returned datasets,<br>
			queries and workflows in AstroGrid environment.
			]]></tooltip>
		</action>
	</contribution>	
	
		<contribution configuration-id="system.uiStructure" if="not (property ui.registryBrowser.disabled)" >	
		<action parentName="apps" name="registryBrowser" text="Resources" iconName="resource.png"
			object="service:registryBrowser" methodName="show" after="myspaceBrowser" >
			<tooltip><![CDATA[
			<html>Simple text-entry search for available <br>
			services and archives in the VO registry.
			]]></tooltip>			
		</action>
	</contribution>			
	
	
	<!-- everything else - eager when testing -->
	<contribution configuration-id="hivemind.EagerLoad" if="property acr.debug">
		<load service-id="astroscope" />
		<load service-id="helioscope" />
		<load service-id="lookout" />
		<load service-id="parameterizedWorkflows" />
		<load service-id="applicationLauncher" />
		<load service-id="workflowBuilder" />
		<load service-id="myspaceBrowser" />
		<load service-id="jobMonitor" />
		<load service-id="registryBrowser" />
	</contribution>	
	
	<!-- services and implementations -->

	<!-- todo - make a non-singleton -->
	<service-point id="astroscope" interface="AstroScope">
		<invoke-factory> 
			<construct class="org.astrogrid.desktop.modules.ui.AstroScopeLauncherImpl" >
				<service>system.ui</service> 
				<service>system.configuration</service>
				<service>system.help</service>
				<service>astrogrid.myspace</service>
				<service>dialogs.resourceChooser</service>
				<service>astrogrid.registry</service>
				<service>ivoa.siap</service>
				<service>nvo.cone</service>
				<service>ivoa.ssap</service>
				<service>cds.sesame</service>
				<service>plastic.hub</service>		
				<event-listener service-id="builtin.shutdown" />																																	
			</construct>
		</invoke-factory>	
	</service-point>

	<implementation service-id="astroscope" if="property ui.astroscope.disabled">
		<invoke-factory service-id="hivemind.lib.PlaceholderFactory" />	
	</implementation>
	
	<service-point id="helioscope" interface="HelioScope">
		<invoke-factory>
			<construct class="org.astrogrid.desktop.modules.ui.HelioScopeLauncherImpl" >
				<service>system.ui</service> 
				<service>system.configuration</service>
				<service>system.help</service>
				<service>astrogrid.myspace</service>
				<service>dialogs.resourceChooser</service>
				<service>astrogrid.registry</service>
				<service>astrogrid.stap</service>
				<service>plastic.hub</service>								
				<event-listener service-id="builtin.shutdown" />																											
			</construct>
		</invoke-factory>	
	</service-point>

	<implementation service-id="helioscope" if="property ui.helioscope.disabled">
		<invoke-factory service-id="hivemind.lib.PlaceholderFactory" />	
	</implementation>	
			
	<service-point id="lookout" interface="Lookout">
		<interceptor service-id="astrogrid.login" />	
		<invoke-factory>
			<construct class="org.astrogrid.desktop.modules.ui.LookoutImpl" >
				<service>system.configuration</service>
				<service>system.help</service>
				<service>system.ui</service>
				<service>astrogrid.recorder</service>
				<service>dialogs.resourceChooser</service>
				<service>astrogrid.myspace</service>
				<service>parameterizedWorkflows</service>
				<service>workflowBuilder</service>
				<service>applicationLauncher</service>
				<service>astrogrid.processManager</service>
				<configuration>astrogrid.processStrategies</configuration>
				<service>system.browser</service>
				<service>astrogrid.jobs</service>
				<service>framework.stylesheetTransformer</service>
				<event-listener service-id="builtin.shutdown" />						
			</construct>
		</invoke-factory>	
	</service-point>

	<implementation service-id="lookout" if="property ui.lookout.disabled">
		<invoke-factory service-id="hivemind.lib.PlaceholderFactory" />	
	</implementation>	

	<service-point id="parameterizedWorkflows" interface="ParameterizedWorkflowLauncher">
		<interceptor service-id="astrogrid.login" />
		<invoke-factory>
			<construct class="org.astrogrid.desktop.modules.ui.ParameterizedWorkflowLauncherImpl" >
				<service>astrogrid.community</service>
				<service>lookout</service>
				<service>astrogrid.jobs</service>
				<service>astrogrid.myspace</service>
				<service>astrogrid.applications</service>
				<service>dialogs.toolEditor</service>
				<service>dialogs.resourceChooser</service>		
				<configuration>workflowTemplates</configuration>
			</construct>
		</invoke-factory>	
	</service-point>

	<implementation service-id="parameterizedWorkflows" if="property ui.parameterizedWorkflows.disabled">
		<invoke-factory service-id="hivemind.lib.PlaceholderFactory" />				
	</implementation>	
	
	<!-- todo: make non singlton -->
	<!-- todo - pass in a configuration -->
	<service-point id="applicationLauncher" interface="ApplicationLauncher">
		<invoke-factory>
			<construct class="org.astrogrid.desktop.modules.ui.ApplicationLauncherImpl" >
				<configuration>dialogs.toolEditors</configuration>
				<service>dialogs.resourceChooser</service>
				<service>astrogrid.applications</service>
				<service>astrogrid.myspace</service>
				<service>lookout</service>		
				<service>system.configuration</service>
				<service>system.help</service>
				<service>system.ui</service>
				<event-listener service-id="builtin.shutdown" />						
			</construct>
		</invoke-factory>	
	</service-point>

	<implementation service-id="applicationLauncher" if="property ui.applicationLauncher.disabled">
		<invoke-factory service-id="hivemind.lib.PlaceholderFactory" />	
	</implementation>	

	<!-- make non-singleton -->
	<service-point id="workflowBuilder" interface="WorkflowBuilder">
		<invoke-factory>
			<construct class="org.astrogrid.desktop.modules.ui.WorkflowBuilderImpl" >
				<service>astrogrid.applications</service>
				<service>astrogrid.jobs</service>
				<service>lookout</service>
				<service>astrogrid.myspace</service>
				<service>system.browser</service>
				<service>dialogs.toolEditor</service>
				<service>dialogs.resourceChooser</service>
				<service>system.ui</service>
				<service>system.help</service>
				<service>system.configuration</service>				
				<event-listener service-id="builtin.shutdown" />						
			</construct>
		</invoke-factory>	
	</service-point>

	<implementation service-id="workflowBuilder" if="property ui.workflowBuilder.disabled">
		<invoke-factory service-id="hivemind.lib.PlaceholderFactory" />	
	</implementation>				

	
	<service-point id="myspaceBrowser" interface="MyspaceBrowser">
		<interceptor service-id="astrogrid.login" />
		<invoke-factory>
			<construct class="org.astrogrid.desktop.modules.ui.VospaceBrowserImpl" >
				<service>system.configuration</service>
				<service>system.help</service>
				<service>system.ui</service>
				<service>astrogrid.myspace</service>
				<service>system.browser</service>
				<service>dialogs.resourceChooser</service>			
				<event-listener service-id="builtin.shutdown" />	
				<event-listener service-id="astrogrid.community" />						
			</construct>
		</invoke-factory>	
	</service-point>

	<implementation service-id="myspaceBrowser" if="property ui.myspaceBrowser.disabled">
		<invoke-factory service-id="hivemind.lib.PlaceholderFactory" />	
	</implementation>
	
	<!-- for backwards compatabiltiy - delegates to lookout -->		
	<service-point id="jobMonitor" interface="JobMonitor">
		<invoke-factory>
			<construct class="org.astrogrid.desktop.modules.ui.LegacyJobMonitor" />
		</invoke-factory>	
	</service-point>

	<implementation service-id="jobMonitor" if="property ui.lookout.disabled"> <!-- disable this if lookout is disabled -->
		<invoke-factory service-id="hivemind.lib.PlaceholderFactory" />	
	</implementation>	
	
	<!-- make non singleton -->
	<service-point id="registryBrowser" interface="RegistryBrowser">
		<invoke-factory>
			<construct class="org.astrogrid.desktop.modules.ui.RegistryBrowserImpl" >
				<service>astrogrid.registry</service>
				<service>system.help</service>
				<service>system.ui</service>
				<service>system.configuration</service>
				<event-listener service-id="builtin.shutdown" />						
			</construct>
		</invoke-factory>	
	</service-point>

	<implementation service-id="registryBrowser" if="property ui.registryBrowser.disabled">
		<invoke-factory service-id="hivemind.lib.PlaceholderFactory" />	
	</implementation>	
				
 </module>
 
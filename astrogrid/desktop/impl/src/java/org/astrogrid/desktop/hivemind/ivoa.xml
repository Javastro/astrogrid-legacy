<?xml version="1.0"?>
<!DOCTYPE module  [
	<!ENTITY descriptors SYSTEM "classpath:/org/astrogrid/desktop/hivemind/ivoa-descriptors.xml">
	]>
<module id="ivoa" version="1.0.0" package="org.astrogrid.acr.ivoa">
	IVOA standard services.
	<!-- new configurations -->
	
	
	<!-- contributions to existing configurations -->

	
	<contribution configuration-id="framework.descriptors">
		<acr-module name="ivoa" description="IVOA Standard Services">
		&descriptors;
		</acr-module>
	</contribution>	
		
	<contribution configuration-id="framework.acrServices">
			<acrService id="ssap" interface="Ssap" />
			<acrService id="siap" interface="Siap" />
			<acrService id="skyNode" interface="SkyNode"/>
			<acrService id="adql074" interface="Adql074" />
			<acrService id="registry" interface="Registry" />
			<acrService id="externalRegistry" interface="ExternalRegistry" />
	</contribution>
	
	<contribution configuration-id="system.uiStructure" if="not (property system.browser.disabled)">
		<action parentName="projects" name="ivoaProject" text="IVOA" iconName="ivoa.gif"
			object="service:system.browser" methodName="openURL"
			>
			<tooltip>Home Page for the International Virtual Observatory Alliance</tooltip>
			<parameter>http://www.ivoa.net</parameter>
		</action>		

	</contribution>	
	
		<!-- factory defaults for enabled services and config properties -->
	<contribution configuration-id="hivemind.FactoryDefaults">
		<default symbol="ivoa.adql074.endpoint" value="http://openskyquery.net/AdqlTranslator/ADQLTrans.asmx"/>			
		<default symbol="ivoa.registry.of.registries.endpoint" value="http://FILL.ME.IN" />
		
		<!-- astrogrid prefix, but in this descriptor - as used within the registry component -->
		<default symbol="org.astrogrid.registry.query.endpoint" 
			value="http://galahad.star.le.ac.uk:8080/galahad-registry/services/RegistryQuery" />
		<default symbol="org.astrogrid.registry.query.altendpoint"
			value="http://cass123.ast.cam.ac.uk/astrogrid-registry/services/RegistryQuery" />
		
	</contribution>

	
	<!-- everything else - eager when testing -->
	<contribution configuration-id="hivemind.EagerLoad" if="property acr.debug">
		<load service-id="ssap"/>
		<load service-id="siap" />
		<load service-id="skyNode" />
		<load service-id="adql074" />
		<load service-id="registry" />
		<load service-id="externalRegistry" />
	</contribution>	
	
	<!-- services and implementations -->
	
	<service-point id="registry" interface="org.astrogrid.desktop.modules.ivoa.RegistryInternal">
		System Registry
		<interceptor service-id="system.throbber" />
		<invoke-factory>
			<construct class="org.astrogrid.desktop.modules.ivoa.StreamingRegistryImpl" >
				<service>externalRegistry</service>
				<string>${org.astrogrid.registry.query.endpoint}</string>
				<string>${org.astrogrid.registry.query.altendpoint}</string>
				<service>system.cache</service>				
			</construct>
		</invoke-factory>
	</service-point>
	
	<implementation service-id="registry" if="property ivoa.registry.disabled">
		<invoke-factory service-id="hivemind.lib.PlaceholderFactory" />	
	</implementation>	
	
	<service-point id="externalRegistry" interface="org.astrogrid.desktop.modules.ivoa.ExternalRegistryInternal">
		External Registries.
		<!-- todo add a cache interceptor, before the throbber -->
		<interceptor service-id="system.throbber" />
		<invoke-factory>
			<construct class="org.astrogrid.desktop.modules.ivoa.StreamingExternalRegistryImpl" >
				<string>${ivoa.registry.of.registries.endpoint}</string>
			</construct>
		</invoke-factory>	
	</service-point>
	
		<implementation service-id="externalRegistry" if="property ivoa.externalRegistry.disabled">
		<invoke-factory service-id="hivemind.lib.PlaceholderFactory" />	
	</implementation>
	
	<service-point id="ssap" interface="Ssap">
		Simple Spectral Access Protocol
		<interceptor service-id="system.throbber" />		
		<invoke-factory>
			<construct class="org.astrogrid.desktop.modules.ivoa.SsapImpl" >
				<service>ivoa.registry</service>
				<service>astrogrid.myspace</service>
			</construct>
		</invoke-factory>	
	</service-point>

	<implementation service-id="ssap" if="property ivoa.ssap.disabled">
		<invoke-factory service-id="hivemind.lib.PlaceholderFactory" />	
	</implementation>
			
		<service-point id="skyNode" interface="SkyNode">
			Skynode (unfinished)
		<interceptor service-id="system.throbber" />			
		<invoke-factory>
			<construct class="org.astrogrid.desktop.modules.ivoa.SkyNodeImpl"/>
		</invoke-factory>			
	</service-point>
	
	<implementation service-id="skyNode" if="property ivoa.skynode.disabled">
		<invoke-factory service-id="hivemind.lib.PlaceholderFactory" />	
	</implementation>

	<service-point id="siap" interface="Siap">
		Simple Image Access Protocol
		<interceptor service-id="system.throbber" />		
		<invoke-factory>
			<construct class="org.astrogrid.desktop.modules.ivoa.SiapImpl">
				<service>ivoa.registry</service>
				<service>astrogrid.myspace</service>
			</construct>			
		</invoke-factory>			
	</service-point>
	
	<implementation service-id="siap" if="property ivoa.siap.disabled">
		<invoke-factory service-id="hivemind.lib.PlaceholderFactory" />	
	</implementation>	

	<service-point id="adql074" interface="Adql074">
		ADQL convertor
		<interceptor service-id="system.throbber" />		
		<invoke-factory>
			<construct class="org.astrogrid.desktop.modules.ivoa.Adql074DynamicImpl">
				<set property="endpoint" value="${ivoa.adql074.endpoint}" />
			</construct>
		</invoke-factory>			
	</service-point>
	
	<implementation service-id="adql074" if="property ivoa.adql074.disabled">
		<invoke-factory service-id="hivemind.lib.PlaceholderFactory" />	
	</implementation>		
	
	
 </module>
 
<?xml version="1.0"?>
<!DOCTYPE module  [
	<!ENTITY descriptors SYSTEM "classpath:/org/astrogrid/desktop/hivemind/dialogs-descriptors.xml">
	]>
<module id="dialogs" version="1.0.0" package="org.astrogrid.acr.dialogs">
	User Interface Dialogues.
	<dependency module-id="system" />
	<dependency module-id="astrogrid" />
	<!-- PREAMBLE -->
	<contribution configuration-id="framework.descriptors">
		<acr-module name="dialogs" description="Reusable UI Dialogues">
		&descriptors;
		</acr-module>
	</contribution>	
		
	<contribution configuration-id="framework.acrServices">
			<acrService id="resourceChooser" interface="ResourceChooser"/>
			<acrService id="toolEditor" interface="ToolEditor" />
			<acrService id="registryChooser" interface="RegistryChooser" />
			<acrService id="registryGoogle" interface="RegistryGoogle" />
	</contribution>

<!-- 
==========================
RESOURCE (FILE) CHOOSER
 -->
 	<!--  todo - make non-singleton -->
	<service-point id="resourceChooser" interface="org.astrogrid.desktop.modules.dialogs.ResourceChooserInternal">
		Select a local or myspace file
		<interceptor service-id="astrogrid.login" />
		<invoke-factory>
			<construct class="org.astrogrid.desktop.modules.dialogs.ResourceChooserImpl" >
			    <service>astrogrid.myspace</service>
			    <service>ui.sendTo</service>
				<service>system.configuration</service>
				<service>system.help</service>
				<service>system.ui</service>
				<service>astrogrid.community</service>		
				<boolean>${dialogs.resourceChooser.useNewDialog}</boolean>		
			</construct>
		</invoke-factory>	
	</service-point>

	<implementation service-id="resourceChooser" if="property dialogs.resourceChooser.disabled">
		<invoke-factory service-id="hivemind.lib.PlaceholderFactory" />	
	</implementation>
	
	<contribution configuration-id="framework.preferences">
		<preference name="dialogs.resourceChooser.useNewDialog" 
			advanced="true"
			requires-restart="true"
			default-value="true" >
			<ui-name>Use new-style dialogs</ui-name>
			<description>select new or old filechooser dialogue implementation</description>
			<option>true</option>
			<option>false</option>
			</preference>
	</contribution>	

	<contribution configuration-id="system.uiStructure" >
		<action parentName="debug" name="driveResourceChooser" 
			text="Launch ResourceChooser" visibleCondition="preference:acr.debug"
			object="service:resourceChooser" methodName="chooseResource" >
			<parameter>Choose file</parameter>
			<parameter>true</parameter>
		</action>
	</contribution>			
<!-- 
===========================
TOOL EDITOR
 -->
	<!-- todo: make non-singleton? -->			
	<service-point id="toolEditor" interface="org.astrogrid.desktop.modules.dialogs.ToolEditorInternal">
		Edit a remote application invocation.
		<invoke-factory>
			<construct class="org.astrogrid.desktop.modules.dialogs.ToolEditorImpl" >
				<configuration>toolEditors</configuration>
				<service>resourceChooser</service>
				<service>ivoa.registry</service>
				<service>system.configuration</service>
				<service>system.help</service>
				<service>system.ui</service>
				<service>astrogrid.applications</service>
				<service>astrogrid.myspace</service>	
				<service>system.browser</service>							
			</construct>
		</invoke-factory>	
	</service-point>

	<implementation service-id="toolEditor" if="property dialogs.toolEditor.disabled">
		<invoke-factory service-id="hivemind.lib.PlaceholderFactory" />	
	</implementation>
	
	<configuration-point id="toolEditors" schema-id="system.objects">
	 	List of tool editors. Each must implemen ToolEditorPanelFactory;
	</configuration-point>
	
	<contribution configuration-id="toolEditors">
		<object>service:chooserPanel</object>
		<object>service:adqlPanel</object>
		<object>service:basicPanel</object>
		<object>service:xmlPanel</object>
		<object>service:informationPanel</object>
		<object>service:securityPanel</object>
	</contribution>
	
		<contribution configuration-id="system.uiStructure">
		<action parentName="debug" name="driveToolEditor" text="Launch ToolEditor"
			object="service:toolEditor" methodName="selectAndBuild" 
			visibleCondition="preference:acr.debug"/>
	</contribution>		
<!-- 
=======================
SIMPLIFIED TOOL EDITOR
 -->	
	<service-point id="simpleToolEditor" interface="org.astrogrid.desktop.modules.dialogs.ToolEditorInternal">
		Edit a remote application invocation in a very simple tool editor
		<invoke-factory>
			<construct class="org.astrogrid.desktop.modules.dialogs.ToolEditorImpl" >
				<service>basicPanel</service>
				<service>system.configuration</service>
				<service>system.help</service>
				<service>system.ui</service>
				<service>astrogrid.applications</service>
				<service>astrogrid.myspace</service>						
			</construct>
		</invoke-factory>	
	</service-point>

	<implementation service-id="simpleToolEditor" if="property dialogs.toolEditor.disabled">
		<invoke-factory service-id="hivemind.lib.PlaceholderFactory" />	
	</implementation>	

<!--  
============================
REGISTRY GOOGLE
 -->
		<!-- todo: make non-singleton -->
	<service-point id="registryGoogle" interface="RegistryGoogle">
		Select a registry resource
		<invoke-factory>
			<construct class="org.astrogrid.desktop.modules.dialogs.RegistryGoogleImpl" >
				<service>system.configuration</service>
				<service>system.help</service>
				<service>system.ui</service>
				<service>ivoa.registry</service>
				<service>system.browser</service>
				<service>ui.registryBrowser</service>
				<service>ivoa.cache</service>
				<service>votech.vomon</service>
			</construct>
		</invoke-factory>	
	</service-point>

	<implementation service-id="registryGoogle" if="property dialogs.registryGoogle.disabled">
		<invoke-factory service-id="hivemind.lib.PlaceholderFactory" />	
	</implementation>		

	<contribution configuration-id="system.uiStructure">
		<action parentName="debug" name="driveRegistryChooser"
			 text="Launch RegistryChooser" visibleCondition="preference:acr.debug"
			object="service:registryGoogle" methodName="selectResources" >		
			<parameter>Choose a resource!</parameter>
			<parameter>false</parameter>
		</action>
	</contribution>		
	
	<!-- obsolete version - only present for backwards compat. -->
<service-point id="registryChooser" interface="RegistryChooser">
		Select a registry resource (obsolete)
		<interceptor service-id="system.deprecation"/>
		<invoke-factory>
			<construct class="org.astrogrid.desktop.modules.dialogs.RegistryChooserImpl" >
				<service>dialogs.registryGoogle</service>
				<service>astrogrid.registry</service>
			</construct>
		</invoke-factory>	
	</service-point>

	<implementation service-id="registryChooser" if="property dialogs.registryChooser.disabled">
		<invoke-factory service-id="hivemind.lib.PlaceholderFactory" />	
	</implementation>		
	
	
	<!-- =================
	TOOL EDITOR PANES
	 -->
	<service-point id="informationPanel" visibility="private" interface="org.astrogrid.desktop.modules.dialogs.editors.ToolEditorPanelFactory">
		Displays information on the tool - repeats information shown on the chooser pane, really. candidate for removal.
		<invoke-factory model="primitive">
			<construct class="org.astrogrid.desktop.modules.dialogs.editors.ToolinformationPanelFactory">
				<service>astrogrid.applications</service>
			</construct>
		</invoke-factory>
	</service-point>
	
	<service-point id="xmlPanel" visibility="private" interface="org.astrogrid.desktop.modules.dialogs.editors.ToolEditorPanelFactory">
		a panel which displays the undelrying xmld tool document - a candidate for hiding.
		<invoke-factory model="primitive">
			<construct class="org.astrogrid.desktop.modules.dialogs.editors.RawXMLToolEditorPanelFactory">
				<service>astrogrid.applications</service>
			</construct>
		</invoke-factory>
	</service-point>	
	
	<service-point id="chooserPanel" visibility="private" interface="org.astrogrid.desktop.modules.dialogs.editors.ToolEditorPanelFactory">
		registry-browsing panel
		<invoke-factory model="primitive">
			<construct class="org.astrogrid.desktop.modules.dialogs.editors.ChooseToolEditorPanelFactory">
				<service>ivoa.registry</service>
				<service>astrogrid.applications</service>
				<service>system.browser</service>
				<service>ui.registryBrowser</service>
				<service>ivoa.cache</service>
				<service>votech.vomon</service>
			</construct>
		</invoke-factory>
	</service-point>	
	
	<service-point id="basicPanel" visibility="private" interface="org.astrogrid.desktop.modules.dialogs.editors.ToolEditorPanelFactory">
		basic form-input panel
		<invoke-factory model="primitive">
			<construct class="org.astrogrid.desktop.modules.dialogs.editors.BasicToolEditorPanelFactory">
				<service>resourceChooser</service>
			</construct>
		</invoke-factory>
	</service-point>	
	
	<service-point id="adqlPanel" visibility="private" interface="org.astrogrid.desktop.modules.dialogs.editors.ToolEditorPanelFactory">
		Allows user to build adql queries
		<invoke-factory model="primitive">
			<construct class="org.astrogrid.desktop.modules.dialogs.editors.ADQLToolEditorPanelFactory">
				<service>resourceChooser</service>
				<service>registryGoogle</service>
				<service>astrogrid.myspace</service>
				<service>ivoa.registry</service>
			</construct>
		</invoke-factory>
	</service-point>	
	
	<service-point id="securityPanel" visibility="private" interface="org.astrogrid.desktop.modules.dialogs.editors.ToolEditorPanelFactory">
		Allows user to provide credentials to the service
		<invoke-factory model="primitive">
			<construct class="org.astrogrid.desktop.modules.dialogs.editors.SecurityToolEditorPanelFactory">
				<service>astrogrid.community</service>
			</construct>
		</invoke-factory>
	</service-point>				
 </module>


 
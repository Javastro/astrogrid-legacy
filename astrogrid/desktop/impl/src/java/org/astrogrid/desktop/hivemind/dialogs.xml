<?xml version="1.0"?>
<!DOCTYPE module  [
	<!ENTITY descriptors SYSTEM "classpath:/org/astrogrid/desktop/hivemind/dialogs-descriptors.xml">
	]>
<module id="dialogs" version="1.0.0" package="org.astrogrid.acr.dialogs">
	User Interface Dialogues.
	<dependency module-id="system" />
	<dependency module-id="astrogrid" />
	<!-- PREAMBLE -->
	<contribution configuration-id="framework.descriptors">
		<acr-module name="dialogs" description="Reusable UI Dialogues">
		&descriptors;
		</acr-module>
	</contribution>	
		
	<contribution configuration-id="framework.acrServices">
			<acrService id="resourceChooser" interface="ResourceChooser"/>
			<acrService id="toolEditor" interface="ToolEditor" />
			<acrService id="registryGoogle" interface="RegistryGoogle" />
	</contribution>

<!-- 
==========================
RESOURCE (FILE) CHOOSER
 -->
 	<!--  todo - make non-singleton -->
	<service-point id="resourceChooser" interface="org.astrogrid.desktop.modules.dialogs.ResourceChooserInternal">
		Select a local or myspace file
		<invoke-factory model="session">
			<construct class="org.astrogrid.desktop.modules.dialogs.ResourceChooserImpl" >
			    <service>astrogrid.myspace</service>
				<service>astrogrid.community</service>			
			</construct>
		</invoke-factory>	
	</service-point>

	<implementation service-id="resourceChooser" if="property dialogs.resourceChooser.disabled">
		<invoke-factory service-id="hivemind.lib.PlaceholderFactory" />	
	</implementation>
	

	<contribution configuration-id="system.uiStructure" >
		<action parentName="debug"  onEventDispatchThread="true"  before="*"
			name="fullChooseResource1" 
			text="fullChooseResource(ms=true,file=true,uri=true)" 
			object="service:resourceChooser" methodName="fullChooseResource" >
			<parameter>fullChooseResource(ms=true,file=true,uri=true)</parameter>
			<parameter>true</parameter>
			<parameter>true</parameter>
			<parameter>true</parameter>
		</action>
		<action parentName="debug"  onEventDispatchThread="true"  after="fullChooseResource1"
			name="fullChooseResource2" 
			text="fullChooseResource(ms=false,file=true,uri=false)"
			object="service:resourceChooser" methodName="fullChooseResource" >
			<parameter>fullChooseResource(ms=false,file=true,uri=false)</parameter>
			<parameter>false</parameter>
			<parameter>true</parameter>
			<parameter>false</parameter>
		</action>		
		<action parentName="debug"  onEventDispatchThread="true" 
			name="fullChooseResource3" after="fullChooseResource2"
			text="fullChooseResource(ms=true,file=false,uri=true)" 
			object="service:resourceChooser" methodName="fullChooseResource" >
			<parameter>fullChooseResource(ms=true,file=false,uri=true)</parameter>
			<parameter>true</parameter>
			<parameter>false</parameter>
			<parameter>true</parameter>
		</action>
		<action parentName="debug"  onEventDispatchThread="true" 
			name="chooseDirectory1" after="fullChooseResource3"
			text="chooseDirectory(ms=true,file=true,uri=true)" 
			object="service:resourceChooser" methodName="chooseDirectoryWithParent" >
			<parameter>chooseDirectory(ms=true,file=true,uri=true)</parameter>
			<parameter>true</parameter>
			<parameter>true</parameter>
			<parameter>true</parameter>
			<parameter>null</parameter>
		</action>
	
	</contribution>			
<!-- 
===========================
TOOL EDITOR - TODO - reimplement using regExplorer.
 -->
	<!-- todo: make non-singleton? -->			
	<service-point id="toolEditor" interface="org.astrogrid.desktop.modules.dialogs.ToolEditorInternal">
		Edit a remote application invocation.
		<invoke-factory model="session">
			<construct class="org.astrogrid.desktop.modules.dialogs.ToolEditorImpl" >
				<configuration>toolEditors</configuration>
				<service>resourceChooser</service>
				<service>ivoa.registry</service>
				<service>system.ui</service>
				<service>astrogrid.applications</service>
				<service>astrogrid.myspace</service>	
				<object>preference:acr.advanced</object>							
			</construct>
		</invoke-factory>	
	</service-point>

	<implementation service-id="toolEditor" if="property dialogs.toolEditor.disabled">
		<invoke-factory service-id="hivemind.lib.PlaceholderFactory" />	
	</implementation>
	
	<configuration-point id="toolEditors" schema-id="system.objects">
	 	List of tool editors. Each must implemen ToolEditorPanelFactory;
	</configuration-point>
	
	<contribution configuration-id="toolEditors">
		<object>service:adqlPanel</object>
		<object>service:basicPanel</object>
		<object>service:securityPanel</object>
	</contribution>
	
	<!--  subsets used within main UI windows -->
	<configuration-point id="regScopeToolEditors" schema-id="system.objects">
		List of tool editors to use for the registryScope app Launcher - temporary fix until something better is written.
	</configuration-point>
	<contribution configuration-id="regScopeToolEditors">
		<object>service:basicPanel</object>
		<object>service:securityPanel</object>
	</contribution>

	<configuration-point id="regScopeQueryEditors" schema-id="system.objects">
		List of tool editors to use for the registryScope query editor - temporary fix until something better is written
	</configuration-point>
	<contribution configuration-id="regScopeQueryEditors">
		<object>service:adqlPanel</object>
		<object>service:basicPanel</object>
		<object>service:securityPanel</object>
	</contribution>
	
		<contribution configuration-id="system.uiStructure">
		<action parentName="debug" onEventDispatchThread="true" name="driveToolEditor" text="Launch ToolEditor"
			object="service:toolEditor" methodName="selectAndBuild" />
	</contribution>		
	<contribution configuration-id="system.helpmap">
		<item id="userInterface.taskEditor" url="http://www2.astrogrid.org/science" />
	</contribution>	
<!-- 
=======================
SIMPLIFIED TOOL EDITOR
 -->	
	<service-point id="simpleToolEditor" interface="org.astrogrid.desktop.modules.dialogs.ToolEditorInternal">
		Edit a remote application invocation in a very simple tool editor
		<invoke-factory model="session">
			<construct class="org.astrogrid.desktop.modules.dialogs.ToolEditorImpl" >
				<service>basicPanel</service>
				<service>system.configuration</service>
				<service>system.help</service>
				<service>system.ui</service>
				<service>astrogrid.applications</service>
				<service>astrogrid.myspace</service>						
			</construct>
		</invoke-factory>	
	</service-point>

	<implementation service-id="simpleToolEditor" if="property dialogs.toolEditor.disabled">
		<invoke-factory service-id="hivemind.lib.PlaceholderFactory" />	
	</implementation>	

<!--  
============================
REGISTRY GOOGLE
 -->
		<!-- FIXME: alter to use an instance of voexplorer here instead. -->
	<service-point id="registryGoogle" interface="RegistryGoogle">
		Select a registry resource
		<invoke-factory model="session">
			<construct class="org.astrogrid.desktop.modules.dialogs.RegistryGoogleImpl" >
				<service>system.ui</service>
				<object>object:registryGooglePanel</object>
			</construct>
		</invoke-factory>	
	</service-point>

	<contribution configuration-id="hiveutils.ObjectBuilderObjects">
		Describes how to build a new registry google panel.
		It's a complex thing to construct - using an object builder
		means we only need to describe the construction in one place,
		and then pass an instancoe of the ObjectBuilder factory
		into wherever a googlePanel is needed.
		<object name="registryGooglePanel" class="org.astrogrid.desktop.modules.ui.voexplorer.RegistryGooglePanel">
			<inject object="service:ivoa.registry" />
			<inject object="cache:resources" />
			<inject object="cache:bulk" />
			<inject object="service:resourceViewersFactory" />
			<inject object="service:votech.vomon" />
			<inject object="service:capabilityIconFactory" />
			<inject object="service:votech.annotate" />
		</object>
	</contribution>
	
		<!--  todo: refactor location of registryGooglePanel so that this icon factory
		can be in ui module, and private to it. -->
		<service-point id="capabilityIconFactory" 
		interface="org.astrogrid.desktop.modules.ui.voexplorer.google.CapabilityIconFactory" >
		Shared component that creates composite capability icons.
		A service, as can be shared between all instances of voexplorer.
		<create-instance model="primitive"
			class="org.astrogrid.desktop.modules.ui.voexplorer.google.CapabilityIconFactoryImpl"
			/>
	</service-point>
	
	<implementation service-id="registryGoogle" if="property dialogs.registryGoogle.disabled">
		<invoke-factory service-id="hivemind.lib.PlaceholderFactory" />	
	</implementation>		

	<contribution configuration-id="system.uiStructure">
		<action parentName="debug" name="driveRegistryChooser" onEventDispatchThread="true"
			 text="Launch RegistryChooser" 
			object="service:registryGoogle" methodName="selectResources" >		
			<parameter>Choose a resource!</parameter>
			<parameter>false</parameter>
		</action>
	</contribution>		
	
	<!--  help keys for registry panel - they're pointing to the wiki for now. -->
	<contribution configuration-id="system.helpmap">
		<item id="reg.general" url="http://wiki.astrogrid.org/bin/view/Astrogrid/RegistryExplorer" />
		<item id="reg.search" url="http://wiki.astrogrid.org/bin/view/Astrogrid/RegistryExplorer#Search_Field" />
		<item id="reg.filter" url="http://wiki.astrogrid.org/bin/view/Astrogrid/RegistryExplorer#Filter_Field" />
		<item id="reg.filters" url="http://wiki.astrogrid.org/bin/view/Astrogrid/RegistryExplorer#Filters_Table" />
		<item id="reg.table" url="http://wiki.astrogrid.org/bin/view/Astrogrid/RegistryExplorer#Resources_List" />
		<item id="reg.details" url="http://wiki.astrogrid.org/bin/view/Astrogrid/RegistryExplorer#Resource_Details" />
		<item id="reg.xml" url="http://wiki.astrogrid.org/bin/view/Astrogrid/RegistryExplorer#Resource_XML" />
		
	</contribution>

<service-point id="resourceViewersFactory" interface="org.astrogrid.desktop.hivemind.IterableObjectBuilder">
		Object builder for resource viewers
		<invoke-factory model="singleton">
			<construct class="org.astrogrid.desktop.hivemind.IterableObjectBuilderImpl">
				<log />
				<configuration>resourceViewers</configuration>
				<service>hiveutils.ObjectTranslator</service>
				<service>hiveutils.EventLinker</service>
			</construct>
		</invoke-factory>
	</service-point>	

<configuration-point id="resourceViewers" schema-id="hiveutils.ObjectBuilderSchema">
	Configuration point for the list of resource viewers
</configuration-point>

<!--  lists of available resource viewers. 
which ones to display, and in which order, is specified in the program code.-->
<contribution configuration-id="resourceViewers">
	<object name="formatted" class="org.astrogrid.desktop.modules.ui.voexplorer.google.FormattedResourceViewer">
			<inject object="service:system.browser" />
			<inject object="service:ui.registryBrowser" />
	</object>
	<object name="annotated" class="org.astrogrid.desktop.modules.ui.voexplorer.google.AnnotatedResourceViewer">
			<inject object="service:system.browser" />
			<inject object="service:ui.registryBrowser" />
			<inject object="service:votech.annotate" />
	</object>	
	<object name="table" class="org.astrogrid.desktop.modules.ui.voexplorer.google.TabularMetadataViewer"/>
	<object name="form" class="org.astrogrid.desktop.modules.ui.voexplorer.google.ResourceFormViewer" />
	<object name="xml" class="org.astrogrid.desktop.modules.ui.voexplorer.google.XMLResourceViewer">
		<inject object="service:ivoa.registry" />
			<inject object="preference:acr.advanced" />		
	</object>
	<object name="results" class="org.astrogrid.desktop.modules.ui.scope.ResultsResourceViewer" />
</contribution>
	
	<!-- =================
	TOOL EDITOR PANES
	 -->
	<service-point id="basicPanel" visibility="private" interface="org.astrogrid.desktop.modules.dialogs.editors.ToolEditorPanelFactory">
		basic form-input panel
		<invoke-factory model="primitive">
			<construct class="org.astrogrid.desktop.modules.dialogs.editors.BasicToolEditorPanelFactory">
				<service>resourceChooser</service>
			</construct>
		</invoke-factory>
	</service-point>	
	
	<service-point id="adqlPanel" visibility="private" interface="org.astrogrid.desktop.modules.dialogs.editors.ToolEditorPanelFactory">
		Allows user to build adql queries
		<invoke-factory model="primitive">
			<construct class="org.astrogrid.desktop.modules.adqlEditor.ADQLToolEditorPanelFactory">
				<service>resourceChooser</service>
				<service>registryGoogle</service>
				<service>astrogrid.myspace</service>
				<service>ivoa.registry</service>
				<object>preference:acr.advanced</object>		
			</construct>
		</invoke-factory>
	</service-point>	
	
	<service-point id="securityPanel" visibility="private" interface="org.astrogrid.desktop.modules.dialogs.editors.ToolEditorPanelFactory">
		Allows user to provide credentials to the service
		<invoke-factory model="session">
			<construct class="org.astrogrid.desktop.modules.dialogs.editors.SecurityToolEditorPanelFactory">
				<service>astrogrid.community</service>
			</construct>
		</invoke-factory>
	</service-point>				
 </module>


 
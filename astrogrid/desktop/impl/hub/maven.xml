<?xml version="1.0"?>
<!-- extension maven script -->
<project xmlns:j="jelly:core"  xmlns:wb="workbench" >
	
   
    <goal name="astrogrid-build-artifact" prereqs="dist:build-bin"
    description="Build the artifacts and leave in the target directory"
    />
	
        <postGoal name="dist:prepare-bin-filesystem">
        	<echo>Copying dependencies into distro</echo>
                <j:forEach var="lib" items="${pom.artifacts}">
                        <j:set var="dep" value="${lib.dependency}"/>
                                <j:if test="${dep.getProperty('dist.bundle')=='true'}">
                                        <copy todir="${maven.dist.bin.assembly.dir}" file="${lib.path}"/>
                                </j:if>
                </j:forEach>
         </postGoal>	

<!--  all the libs are now in maven.dist.bin.assembly.dir -here we list all the other things we're going to do with them-->
<postGoal name="dist:build-bin">
<!--  strip surplus classes -->
	<attainGoal name="jar-strip" />
<!--  package as a jar file -->
	<attainGoal name="app-jar" />
	<!-- smoke-test it -->
	<attainGoal name="smoke-test" />
	<!--  sign this jar -->	
		<wb:sign />
	<!--  package as a webstart app -->
	<attainGoal name="webstart" />

<!--  package as an osx app -->
	<j:set var="tmpVar" value="${os.name}" />
   <j:if test="${tmpVar == 'Mac OS X'}">
	<attainGoal name="osx" />
	</j:if>	

	
	<!-- package as an installer -->
	<attainGoal name="installer" />

</postGoal>


</project>


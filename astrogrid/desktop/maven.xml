<?xml version="1.0"?>
<!-- extension maven script -->
<project xmlns:maven="jelly:maven"  xmlns:j="jelly:core" xmlns:util="jelly:util" >
	<!-- 
	cleaning 
	-->
	<goal name="astrogrid-clean" prereqs="multiproject:clean"
	description="clean all sub projects - may not be possible if version in maven.base/project.properties has just been changed - clean before doing this">
	</goal>
	
	<!--
	 building stuff 
	-->
	<goal name="astrogrid-install-artifact"
		description="runs install-materials and install-standalone-apps"
		prereqs="install-materials,install-standalone-apps"
	/>
	
 <goal name="install-materials" 
	description="build all the pre-requsites (docs, examples, api jars etc), install them in local repo">
		<maven:reactor
			basedir="${basedir}"
			goals="astrogrid-install-artifact"
			ignoreFailures="false"
			includes="${supporting.projects}" />
	</goal>
	
	<goal name="install-standalone-apps" 
	description="build all the stand-alone (non-webstart) versions of the apps. previously must have run install-materials"
	>
		<maven:reactor
			basedir="${basedir}"
			goals="astrogrid-install-artifact"
			ignoreFailures="false"
			includes="${ar.projects}" />
	</goal>
	
	<!-- 
	deploying stuff
	-->
	<goal name="astrogrid-deploy-artifact"
		description="deploys api jars to central maven repo">
		<j:set var="maven.scm.cvs.tag">
		<util:replace  newChar="_" oldChar=".">DEPLOY_ARTIFACT_${astrogrid.desktop.version}</util:replace>
		</j:set>
	   <attainGoal name="scm:cvs-tag-project" />		
		<maven:maven basedir="api" descriptor="api/project.xml" goals="astrogrid-deploy-artifact" />
	</goal>
	
	<goal name="publish-jnlp"
	description="publish webstart releases for all apps. Requires -Dmaven.username=maven for this to work. must have run install-materials previously"
	>
		<j:set var="maven.scm.cvs.tag">
			<util:replace  newChar="_" oldChar=".">PUBLISH_JNLP_${astrogrid.desktop.version}</util:replace>
		</j:set>
	   <attainGoal name="scm:cvs-tag-project" />
		<maven:reactor
			basedir="${basedir}"
			goals="publish-jnlp"
			ignoreFailures="false"
			includes="${jnlp.ar.projects}"/>
	</goal>
	
	
	<goal name="build-site" 
	description="assemble  the release site for the newly built apps.  must have run 'astrogid-install-artifact' (or install-materials and install-standalone-apps ) previously"
>
		<j:set var="maven.scm.cvs.tag">
		<util:replace  newChar="_" oldChar=".">PUBLISH_SITE_${astrogrid.desktop.version}</util:replace>
		</j:set>
	   <attainGoal name="scm:cvs-tag-project" />		
		<maven:maven basedir="site" descriptor="site/project.xml" ignoreFailures="false" goals="build-site" />
		<echo>The results in site/target/docs now need to be uploaded to the plone site</echo>
		<echo>REMINDER: Do you need to republish the webapps too? run 'maven publish-jnlp</echo>
	</goal>




</project>


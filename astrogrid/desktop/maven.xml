<?xml version="1.0"?>
<!-- extension maven script -->
<project xmlns:maven="jelly:maven"  xmlns:j="jelly:core" xmlns:util="jelly:util" >
	<!-- 
	cleaning 
	-->
	<goal name="astrogrid-clean" prereqs="multiproject:clean,clean:clean"
	description="clean this project and  all sub projects - may not be possible if version in maven.base/project.properties has just been changed - clean before doing this">
	</goal>
	
	<!--
	 building stuff 
	-->
	<goal name="astrogrid-build-artifact"
		description="runs install-materials, then build-artifacts. Gathers results in target/artifacts. "
		prereqs="install-materials,build-artifacts,gather"
	/>
	
 <goal name="install-materials" 
	description="build all the pre-requsites (docs, examples, api jars etc), install them in local repo">
		<maven:maven basedir="api" descriptor="api/project.xml" goals="astrogrid-install-artifact" />
	</goal>
	
	<goal name="build-artifacts" 
	description="build all the different versions of the application. Previously must have run install-materials."
	>
		<maven:reactor
			basedir="${basedir}"
			goals="astrogrid-build-artifact"
			ignoreFailures="false"
			includes="${ar.projects}" />
	</goal>
	
	
	<goal name="gather"
		description="collects together artifacts build by subprojects into a single directory">
		<mkdir dir="${basedir}/target/artifacts"/>
		<move todir="${basedir}/target/artifacts" flatten="true">
			<fileset dir="${basedir}">
				<include name="**/target/*.dmg" /><!--  os images -->
				<include name="**/target/*-app.jar" /><!--  standalone apps -->
				<include name="**/target/*-jnlp.zip" /><!--  webstart -->
				<include name="**/target/distributions/*.zip" /> <!--  distribuitions -->
				<include name="**/target/**/announcement*.txt" /> <!--  release announcement -->
				<include name="**/target/**/*-installer.jar" />
				<!--  specials -->
				<include name="**/target/ar-script-examples*.jar" />
				<!-- api/docs, api/generated-xdocs/xmlrpc doc- already in the api distrubution zip-->
			</fileset>
		</move>
	</goal>
	
	<!-- 
	deploying stuff
	-->
	<goal name="astrogrid-deploy-artifact"
		description="deploys only the api jars to central maven repo">
		<j:set var="maven.scm.cvs.tag">
		<util:replace  newChar="_" oldChar=".">DEPLOY_ARTIFACT_${astrogrid.desktop.version}</util:replace>
		</j:set>
	   <attainGoal name="scm:cvs-tag-project" />		
		<maven:maven basedir="api" descriptor="api/project.xml" goals="astrogrid-deploy-artifact" />
	</goal>


</project>


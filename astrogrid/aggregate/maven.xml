<?xml version="1.0"?>
<!-- extension maven script -->
<project xmlns:j="jelly:core" xmlns:maven="jelly:maven" xmlns:u="jelly:util" xmlns:deploy="deploy">

        <!--+
                | Custom astrogrid goals for nightly build
                | Override those in maven-base
                +-->
        <goal name="astrogrid-clean" prereqs="multiproject:clean"/>
        <goal name="astrogrid-deploy-site"
                prereqs="astrogrid-build-site,site:sshdeploy" />
        <goal name="astrogrid-build-site" prereqs="multiproject:site"/>

<!-- goal to setup a temporary keystore (all jnlp jars must be signed). later we should replace
this with signing with proper astrogrid certificates
-->
<goal name="setup-keystore">
        <u:file var="keystore" name="${systemScope.getProperty('user.home')}${systemScope.getProperty('file.separator')}.keystore" />
        <echo>Checking for keystore at: ${keystore}</echo>
        <j:if test="${! keystore.exists()}">
          <echo>Creating new keystore</echo>
          <genkey alias="astrogrid" storepass="qwertyuiop" validity="900">
                <dname>
                        <param name="CN" value="Astrogrid" />
                        <param name="O" value="Astrogrid Consortium" />
                        <param name="C" value="UK" />
                </dname>
          </genkey>
        </j:if>

</goal>

<goal name="astrogrid-build-artifact" prereqs="setup-keystore">
<!-- using reactor now. more manageable.
        <maven:maven descriptor="${basedir}/cdk/core/project.xml"
                goals="astrogrid-build-artifact" ignoreFailures="false" />
        <maven:maven descriptor="${basedir}/apps/aladin-avo/project.xml"
                goals="astrogrid-build-artifact" ignoreFailures="false" />
-->
        <maven:reactor
                basedir="${basedir}"
                goals="astrogrid-build-artifact"
                ignoreFailures="false"
                includes="${maven.multiproject.includes}"
        />
</goal>

<goal name="astrogrid-build-snapshot"  prereqs="setup-keystore">
<!--
        <maven:maven descriptor="${basedir}/cdk/core/project.xml"
                goals="astrogrid-build-snapshot" ignoreFailures="false" />
-->
        <maven:reactor
                basedir="${basedir}"
                goals="astrogrid-build-artifact"
                ignoreFailures="false"
                includes="${maven.multiproject.includes}"
        />
</goal>


<goal name="astrogrid-install-snapshot"  prereqs="setup-keystore">
        <!--<maven:maven descriptor="${basedir}/cdk/core/project.xml"
                goals="astrogrid-install-snapshot" ignoreFailures="false" />-->
        <maven:reactor
                basedir="${basedir}"
                goals="astrogrid-install-artifact"
                ignoreFailures="false"
                includes="${maven.multiproject.includes}"
        />
</goal>


<goal name="astrogrid-install-artifact"  prereqs="setup-keystore">
        <!--<maven:maven descriptor="${basedir}/cdk/core/project.xml"
                goals="astrogrid-install-artifact" ignoreFailures="false" />-->
        <maven:reactor
                basedir="${basedir}"
                goals="astrogrid-install-artifact"
                ignoreFailures="false"
                includes="${maven.multiproject.includes}"
        />
</goal>


<goal name="astrogrid-deploy-snapshot"  prereqs="setup-keystore">
        <!--<maven:maven descriptor="${basedir}/cdk/core/project.xml"
                goals="astrogrid-deploy-snapshot" ignoreFailures="false" />-->
        <maven:reactor
                basedir="${basedir}"
                goals="astrogrid-deploy-artifact"
                ignoreFailures="false"
                includes="${maven.multiproject.includes}"
        />
</goal>

<goal name="astrogrid-deploy-artifact"  prereqs="setup-keystore">
        <!--<maven:maven descriptor="${basedir}/cdk/core/project.xml"
                goals="astrogrid-deploy-artifact" ignoreFailures="false" />-->
        <maven:reactor
                basedir="${basedir}"
                goals="astrogrid-deploy-artifact"
                ignoreFailures="false"
                includes="${maven.multiproject.includes}"
        />
</goal>



</project>

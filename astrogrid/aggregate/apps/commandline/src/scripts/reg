#!/usr/bin/env groovy
/** commandline interface to query the registry

*/
import org.apache.axis.utils.XMLUtils

import org.apache.commons.cli.HelpFormatter;

class Reg extends org.astrogrid.ui.script.commandline.CommandlineApplication {
// setup commandline options
Reg() {
o.addOption("r","resolve",true,"Resolve identifier to endpoint")
o.addOption("l","list",false,"List identifiers of records in registry (default)")
o.addOption("i","identfier",true,"Ask registry about an identifier")
o.addOption("x","registry",false,"Ask about the registry itself")
o.addOption("q","query",true,"Run a quey against the registry (specify file, or - for stdin)")


// lots more that could be added here, but dunno what it all means really.

['r','l','i','x',"q"].each{og.addOption(o.getOption it)}
o.addOptionGroup og
}

static void main(String[] args) {
        (new Reg()).run(args);
}
void doIt() {
r = astrogrid.createRegistryClient()



if (line.hasOption "r") {
        idname = line.getOptionValue "r"
        println(r.getEndPointByIdentifier idname)
}

else if (line.hasOption("l") || og.selected == null ) {
        doc = r.listIdentifiers()
        XMLUtils.PrettyDocumentToStream(doc,System.out)
}

else if (line.hasOption "i") {
        doc = r.getResourceByIdentifier(line.getOptionValue "i")
        XMLUtils.PrettyDocumentToStream(doc,System.out)
}

else if (line.hasOption "x") {
        doc = r.getRegistries()
        XMLUtils.PrettyDocumentToStream(doc,System.out)
}


else if (line.hasOption "q") {
        input = line.getOptionValue("s") == "-" ? System.in : new java.io.File(line.getOptionValue "q" )
        doc = r.search(r.text)
        XMLUtils.PrettyDocumentToStream(doc,System.out)
}
else {
        displayHelp()
}

}
void displayHelp() {
        (new HelpFormatter()).printHelp(
<<<DOC
reg <options>
query the registry
DOC,
o)
}


}
<!-- ================== Build for OpenJMS using Ant 1.3 =================== -->
<!-- $Id: examples.build.xml,v 1.3 2003/11/24 13:53:18 KevinBenson Exp $ -->

<project name="openjms" default="all" basedir="..">

  <!-- ==================================================================== -->
  <!--                              Properties                              -->
  <!-- ==================================================================== -->
  <!-- main directories -->
  <property name="source.dir" value="src" />
  <property name="etc.dir" value="${source.dir}/etc" />
  <property name="examples.dir" value="${source.dir}/examples" />
  <property name="lib.dir" value="lib" />
  <property name="dist.dir" value="dist" />
  <property name="execute.dir" value="bin" />
  <property name="build.dir" value="build" />

  <!-- Loaded first since the VERSION file could include properties that   -->
  <!-- override some defined in this project                               -->
  <property file="${etc.dir}/VERSION" />
  <property name="build.compiler" value="modern" />
  <property name="deprecation" value="false" />


  <!-- ==================================================================== -->
  <!--                  The classpath used to build the project             -->
  <!-- ==================================================================== -->
  <path id="project.class.path">
    <pathelement path="${lib.dir}/$EXOLABCORE$" />
    <pathelement path="${lib.dir}/$JDBC$" />
    <pathelement path="${lib.dir}/$JMS$" />
    <pathelement path="${lib.dir}/$JNDI$" />
    <pathelement path="${lib.dir}/$JTA$" />
    <pathelement path="${lib.dir}/$LOG4J$" />
    <pathelement path="${lib.dir}/$OTS-JTS$" />
    <pathelement path="${lib.dir}/$OPENJMS_CLIENT$" />
    <pathelement path="${lib.dir}/$OPENJMS_RMI$" />
    <pathelement path="${classes.dir}" />
  </path>


  <!-- ==================================================================== -->
  <!--            The executable files in openjms.home and the bin dir      -->
  <!-- ==================================================================== -->
  <patternset id="executable.files">
    <include name="*.bat"/>
    <include name="*.sh" />
  </patternset>

    
  <!-- ==================================================================== -->
  <!--                       Display all the targets                        -->
  <!-- ==================================================================== -->
  <target name="targets" description="Display all the targets">
    <echo><![CDATA[
    *************************************************************************
     ANT 1.3 build for ${title} version ${version}

     The following targets are available:

     all            Cleans and builds all the packages and examples
     convert        Convert CRLF to CR and visa versa
     clean          Clean the build and distribution package
     examples       Builds the example packages (including debugging info)
    *************************************************************************
        ]]>
    </echo>
  </target>


  <!-- ==================================================================== -->
  <!--                      Prepare target directories                      -->
  <!-- ==================================================================== -->
  <target name="prepare">
    <mkdir dir="${build.dir}"/>
  </target>


  <!-- ==================================================================== -->
  <!--                 Clean the build and distribution package             -->
  <!-- ==================================================================== -->
  <target name="clean" description="Clean the build and distribution package">
    <delete dir="${build.dir}"/>
  </target>


  <!-- ==================================================================== -->
  <!--          Cleans and builds all the packages and examples             -->
  <!-- ==================================================================== -->
  <target name="all" depends="clean,examples"
          description="Cleans and builds all the packages and examples" />


  <!-- ==================================================================== -->
  <!--          Builds the example packages (including debugging info)      -->
  <!-- ==================================================================== -->
  <target name="examples" depends="prepare"
          description="Builds the example packages (including debugging info)">

    <!-- create the builded examples directory -->
    <mkdir dir="${build.dir}/examples" />

    <!-- build the java files -->
    <javac srcdir="${examples.dir}"
           destdir="${build.dir}/examples"
           includes="**/*.java"
           excludes="**/package.html"
           debug="on"
           deprecation="${deprecation}">
           <classpath refid="project.class.path" />
    </javac>

    <!-- generate the sample keystore -->
    <antcall target="make-keystore" />

  </target>


  <!-- ==================================================================== -->
  <!--                Makes the sample keystore if it doesn't exist         -->
  <!-- ==================================================================== -->
  <target name="make-keystore" depends="prepare">
    <condition property="generate-keystore">
      <and>
        <available classname="javax.net.ssl.SSLSocket" />
        <not>
         <available file="${execute.dir}/cacerts" />
        </not>
      </and>
    </condition>
    <antcall target="generate-keystore" />
  </target>

  <target name="generate-keystore" depends="prepare" if="generate-keystore">
    <genkey alias="openjms" storepass="ab1234" 
            keystore="${execute.dir}/cacerts">
      <dname>
        <param name="CN" value="OpenJMS"/>
        <param name="OU" value="Exolab"/>
        <param name="O"  value="Intalio"/>
        <param name="L"  value="Melb"/>
        <param name="ST" value="Vic"/>
        <param name="C"  value="AU"/>
      </dname>
    </genkey>
  </target>


  <!-- ==================================================================== -->
  <!--      Convert the cr/lf for unix and windows                          -->
  <!-- ==================================================================== -->
  <target name="convert">
    <fixcrlf srcdir="." includes="*.sh" cr="remove"/>
    <fixcrlf srcdir="." includes="*.bat" cr="add"/>
    <fixcrlf srcdir="${execute.dir}" includes="*.sh" cr="remove"/>
    <fixcrlf srcdir="${execute.dir}" includes="*.bat" cr="add"/>
    <chmod perm="+x">
      <fileset dir="${execute.dir}">
        <patternset refid="executable.files"/>
      </fileset>
      <fileset dir=".">
        <patternset refid="executable.files"/>
      </fileset>
    </chmod>
  </target>

</project>

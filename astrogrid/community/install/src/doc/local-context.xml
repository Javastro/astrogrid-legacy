<?xml version="1.0" encoding="ISO-8859-1" ?>
<document>
    <properties>
        <title>Local context</title>
    </properties>
    <body>
        <section name="Local context">
            <p>
                One way to configure the JNDI properties is to add them to a WebApp <code>Context</code> element in the Tomcat <code>server.xml</code> configuration file.
            </p>
            <subsection name="Context element">
                <p>
                    The WebApp <code>Context</code> element needs to be added towards the end of the Tomcat configuration file.
<source><![CDATA[
<Server .... >
    ...
    <Service name="Tomcat-Standalone">
        ...
        <Engine name="Standalone" .... >
            ...
            <Host name="localhost" .... >
                ...
                <!--+
                    | Configure a local context for our WebApp.
                    +-->
                <Context path="/astrogrid-community" docBase="astrogrid-community.war">
                    ...
                </Context>
            </Host>
        </Engine>
    </Service>
</Server>
]]></source>
                </p>
	            <subsection name="Context path">
	                <p>
	                    The <code>path</code> attribute of the <code>Context</code> element configures the external URL path for the WebApp.
	                    <br/>
	                    Setting the path to <code>/astrogrid-community</code> will set the external URL for resources within the WebApp to the following.
<source><![CDATA[
http://localhost/astrogrid-community/....
]]></source>
	                </p>
	            </subsection>
	            <subsection name="Context docBase">
	                <p>
	                    The <code>docBase</code> attribute of the <code>Context</code> element configures the location Tomcat will use to load the WebApp.
	                    <p style="font-size:x-small;font-style:italic">
							<img style="float:left;margin-right:5px" src="images/note.gif"/>
	                        Note that setting this to point to a war file will mean that Tomcat will not unpack the war file.
	                        <br/>
	                        Tomcat will serve the WebApp content directly from the war file without unpacking it.
	                    </p>
	                </p>
	            </subsection>
            </subsection>
            <subsection name="Config location">
                <p>
                    The <code>Environment</code> entry for the WebApp configuration file can be placed in the local <code>Context</code> element.
<source><![CDATA[
<Server .... >
    <Service name="Tomcat-Standalone">
        <Engine name="Standalone" .... >
            <Host name="localhost" .... >
                <!--+
                    | Configure a local context for our WebApp.
                    +-->
                <Context path="/astrogrid-community" docBase="astrogrid-community.war">
                    <!--+
                        | The WebApp config file location.
                        +-->
                    <Environment
                        name="org.astrogrid.community.config"
                        type="java.lang.String"
                        value="/etc/astrogrid/astrogrid-community-config.xml"/>
                    ...
                </Context>
            </Host>
        </Engine>
    </Service>
</Server>
]]></source>
                </p>
            </subsection>
            <subsection name="Database resource">
                <p>
                    The database <code>Resource</code> element can be placed in the local <code>Context</code> element.
<source><![CDATA[
<Server .... >
    ...
    <Service name="Tomcat-Standalone">
        ...
        <Engine name="Standalone" .... >
            ...
            <Host name="localhost" .... >
                ...
                <!--+
                    | Configure a local context for our WebApp.
                    +-->
                <Context path="/astrogrid-community" docBase="astrogrid-community.war">
                    ...
                    <!--+
                        | The Community database resource.
                        +-->
                    <Resource
                        name="jdbc/org.astrogrid.community.database"
                        type="javax.sql.DataSource"
                        auth="Container"/>
                    ...
                </Context>
            </Host>
        </Engine>
    </Service>
</Server>
]]></source>
                </p>
            </subsection>
            <subsection name="Database properties">
                <p>
                    The database properties can be placed in the local <code>Context</code> element.
<source><![CDATA[
<Server .... >
    ...
    <Service name="Tomcat-Standalone">
        ...
        <Engine name="Standalone" .... >
            ...
            <Host name="localhost" .... >
                ...
                <!--+
                    | Configure a local context for our WebApp.
                    +-->
                <Context path="/astrogrid-community" docBase="astrogrid-community.war">
                    ...
                    <!--+
                        | The Community database properties.
                        +-->
                    <ResourceParams
                        name="jdbc/org.astrogrid.community.database">
                        <parameter>
                            <name>url</name>
                            <value>jdbc:hsqldb:/var/astrogrid/org.astrogrid.community</value>
                        </parameter>
                        ...
                    </ResourceParams>
                    ...
                </Context>
            </Host>
        </Engine>
    </Service>
</Server>
]]></source>
                </p>
            </subsection>
        </section>
    </body>
</document>

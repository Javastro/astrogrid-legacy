<?xml version="1.0" encoding="UTF-8"?>

<project
    xmlns:ant="jelly:ant"
    xmlns:community="org.astrogrid.community"
    default="astrogrid-install-artifact"
    >

  <goal name="astrogrid-install-artifact" prereqs="jar:install"/>
  <goal name="astrogrid-install-snapshot" prereqs="jar:install-snapshot"/>
  <goal name="astrogrid-build-site"       prereqs="site"/>
  <goal name="astrogrid-deploy-site"      prereqs="site:deploy"/>

    <!--+
        | Prepare the database config files for our JUnit tests.
        +-->
    <preGoal name="test:test-resources">
        <ant:echo message=""/>
        <ant:echo message="Artifact : ${pom.artifactId}"/>
        <ant:echo message="Preparing test-resources ...."/>
        <!--+
            | Setup our database properties.
            +-->
        <ant:property name="database.data"   value="${maven.build.dir}/database/data"/>
        <ant:property name="database.config" value="${maven.build.dir}/database/config"/>
        <!--+
            | Create our target directories.
            +-->
        <ant:mkdir dir="${database.config}"/>
        <ant:mkdir dir="${database.data}"/>

        <!--+
            | Create a Castor JDO config for our default database.
            | This is used by the DatabaseConfiguration tests.
            +-->
        <community:database.generate
            database.files="default"
            database.name="database"
            database.xml="database.xml"
            database.sql="database.sql"
            mapping.xml="mapping.xml"
            />
        <!--+
            | Create a Castor JDO config for our default community database.
            | This is used by the local:://service tests.
            +-->
        <community:database.generate
            database.files="default"
            database.name="org.astrogrid.community.database"
            database.xml="astrogrid-community-database.xml"
            database.sql="astrogrid-community-database.sql"
            mapping.xml="astrogrid-community-mapping.xml"
            />
        <!--+
            | Create a Castor JDO config for our test database(s).
            | This are used by the in-process service tests.
            +-->
        <community:database.generate
            database.files="test-database-001"
            database.name="test-database-001"
            database.xml="test-database-001.xml"
            database.sql="test-database-001.sql"
            mapping.xml="test-mapping-001.xml"
            />
        <community:database.generate
            database.files="test-database-002"
            database.name="test-database-002"
            database.xml="test-database-002.xml"
            database.sql="test-database-002.sql"
            mapping.xml="test-mapping-002.xml"
            />
        <community:database.generate
            database.files="test-database-003"
            database.name="test-database-003"
            database.xml="test-database-003.xml"
            database.sql="test-database-003.sql"
            mapping.xml="test-mapping-003.xml"
            />
        <community:database.generate
            database.files="test-database-004"
            database.name="test-database-004"
            database.xml="test-database-004.xml"
            database.sql="test-database-004.sql"
            mapping.xml="test-mapping-004.xml"
            />
    </preGoal>


</project>

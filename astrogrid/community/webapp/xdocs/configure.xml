<?xml version="1.0" encoding="ISO-8859-1" ?>
<document>
    <properties>
        <title>AstroGrid community configure</title>
    </properties>
    <body>
    <section name="Configuration">
      <p>
          <strong><i>Setup</i></strong>
            <ul>
               <li> 1.) Go to the Administration gui for the servlet container.</li>
               <li> 2.) Go to the Environment Entries for your context.  In Tomcat this is Service->Host(LocalHost)->{context name}->Resources->Environment entries. </li>
               <li> ** Newer tomcat 5.5 does not install Administratin GUI so you much change the context.xml file yourself.  See "JDBC Resources" for <a href="http://jakarta.apache.org/tomcat/tomcat-5.5-doc/jndi-resources-howto.html">Tomcat 5.5</a> or manually for tomcat 5.0 is <a href="http://jakarta.apache.org/tomcat/tomcat-5.0-doc/jndi-resources-howto.html">Tomcat 5.0</a></li>
               <li> 3.) Change all the environment entries, to have the community id, and the endpoints to the registry, also define the registry identifier for a vospace/myspace used for accounts. (Hit Save after each of your changes, see "Note" at the end of this section.)</li>
               <li> 4.) After Environment Entries are changed go to the "DataSources" (same area as Environment Entries) <strong>(see the sample DataSource config below.)</strong> <i>Because of a resource-ref element inside the web.xml a DataSource with only a name filled out may be present</i>. </li>
               <li> 5.) Change the URL to not have "@WORKDIR@" but to a appropriate directory that will keep your database data and information. (Hit Save)</li>
               <li> 6.) In Tomcat hit "Commit Changes" at the top.</li>
               <li> 7.) Open up a web browser and go to your new community ex: http://localhost:8080/{context} </li>
               <li> 8.) Go to the Admin pages, there it will report if your database is healthy or not, if this is the first time then it should NOT be healthy.</li>
               <li> 9.) If not healthy go to "Reset DB" this essentially deletes everything from the db and recreates all tables and a small amount of test data to check if it is healthy.
                (This of course assumes if your not using hsqldb that you gave the user permission to create tables, if not you will need to take the sql file and create tables manually.  See below on "Customize")
               </li>
               <li> 10.) Reset the db and verify it is healthy, a message should say if it is healthy or not.</li>
               <li> 11.) Now click on "Register Metadata" Fill in the Form details and the version of the type of Registry you wish to publish/register to. (hit Submit). Normal current registry version in use is 0.10</li>
               <li> 12.) Verify the XML looks correct and hit (Register). </li>
               <li> 13.) Your Setup is now complete you may begin adding accounts, groups, and others. </li>
            </ul>
                    <i>
                    Note: Only the latest tomcat will let you change the value field past 70 characters.  You may go into your server.xml and change or more preferred is in tomcat you may
                    go to tomcat/conf/Catalina/localhost/{context}.xml file and change the properties manually.  A restart of tomcat is not required in this method but
                    may take up to 30 seconds for tomcat to catch your new changes to this file.<br />
                    *A final note; if you do not see your file in there, then you need to go to the Administration GUI and just hit commit changes, servlet containers
                    such as tomcat only creates the file after a commit changes button is hit; only needs to be done this first time.
                    </i>               
         </p>
         <subsection name="Properties">
         <p>
           These are required for the community to function.
         </p>
           <ul>
               <li>org.astrogrid.community.ident - community identifier, must be changed.</li>
               <li>org.astrogrid.community.default.vospace - default vospace identifier (normally a filemanger)</li>
               <li>org.astrogrid.registry.query.endpoint - regustry query endpoint normally.</li>
               <li>org.astrogrid.registry.admin.endpoint - your publishing registry to send your registry. (may be or may not be the same as the query endpoint)</li>
           </ul>
         <p>
           These are to do with the certificate authority and MyProxy service, which are experimental.
           Don't bother setting these in a production community.
         </p>
         <dl>
           <dt>org.astrogrid.community.cacert</dt>
           <dd>The absolute name of the file containing the certificate authority's root certificate.
               The file should be a PEM file.</dd>
           <dt>org.astrogrid.community.cakey</dt>
           <dd>The absolute name of the file containing the certificate authority's private key.
               The file should be a PEM file. Don't make this file world-readable.</dd>
           <dt>org.astrogrid.community.caserial</dt>
           <dd>The absolute name of the file containing the certificate authority's serial-number
               record. The file should be a text file containing one line. That line contains the
               last serial number to be used in an issued certificate (which is zero for a new
               certificate authority, since the authority's own certificate is number zero).
               The number must be written as hexidecimal digits, padded on the left with zeros
               to make an even number of digits. E.g., 00, 01, 42 and 0fff are all valid;
               1 and 123 are not as they have odd numbers of digits.</dd>
           <dt>org.astrogrid.community.myproxy</dt>
           <dd>The absolute name of the directory in which MyProxy keeps its records. By
               convention, this is /var/myproxy for a MyProxy installation owned by root
               or $GLOBUS_LOCATION/var/myproxy for a MyProxy installation owned by another user.</dd>
         </dl>
         </subsection>
         
         <subsection name="Sample Database Config">
         <p>
           <strong>Sample DataSource Config for hsqldb</strong><br />
           <table>
            <tr>
               <td>Data Source Property</td>
               <td>Example Value</td>
            </tr>
            <tr>
               <td>JNDI Name:</td>
               <td>jdbc/org.astrogrid.community.database</td>
            </tr>
            <tr>
               <td>Data Source URL:</td>
               <td>jdbc:hsqldb:/data/workarea/community/org.astrogrid.community</td>
            </tr>
            <tr>
               <td>JDBC Driver Class:</td>
               <td>org.hsqldb.jdbcDriver</td>
            </tr>
            <tr>
               <td>User Name:</td>
               <td>sa</td>
            </tr>
            <tr>
               <td>Password:</td>
               <td> </td>
            </tr>
           </table>         
         </p>      
         </subsection>
         <subsection name="Castor Engine Types">
         <p>
           <table>
            <tr>
               <td>Engine Type Name</td>
               <td>Database Full Name</td>
            </tr>
            <tr>
               <td>mysql</td>
               <td>MySQL</td>
            </tr>
            <tr>
               <td>db2</td>
               <td>DB/2</td>
            </tr>
            <tr>
               <td>generic</td>
               <td>Generic JDBC support</td>
            </tr>
            <tr>
               <td>hsql</td>
               <td>Hypersonic SQL (default)</td>
            </tr>
            <tr>
               <td>informix</td>
               <td>Informix</td>
            </tr>
            <tr>
               <td>instantdb</td>
               <td>InstantDB</td>
            </tr>
            <tr>
               <td>interbase</td>
               <td>Interbase</td>
            </tr>
            <tr>
               <td>oracle</td>
               <td>Oracle 7 - Oracle 9i</td>
            </tr>
            <tr>
               <td>postgresql</td>
               <td>PostgreSQL 7.1</td>
            </tr>
            <tr>
               <td>sapdb</td>
               <td>SAP DB</td>
            </tr>
            <tr>
               <td>sql-server</td>
               <td>Microsoft SQL Server</td>
            </tr>
            <tr>
               <td>sybase</td>
               <td>Sybase 11</td>
            </tr>
           </table>         
         </p>      
         </subsection>
         <subsection name="Customize">
         <p>
            See the "{context app location}/WEB-INF/classes" directory
              for configuration files if you need to change the sql used to create tables, or possibly even the JDO mapping.  The sql file below is for hsqldb sql syntax which is 
              slightly different than other databases hence it is expected you will need to change the sql file.  You should find a "mysql" example file in this directory
              where by you could copy it over the original "astrogrid-community-database.sql" if you have mysql.
            There are 3 files.
            <ul>
               <li> astrogrid-community-database.sql -- SQL used to create table data. </li>
               <li> astrogrid-community-database.xml -- By default this is setup for hsqldb, but for other databases change the engine type attribute, a list of the engine types are given below.</li>
               <li> astrogrid-community-mapping.xml -- most likely no need to change -- JDO mapping for Castor.  See <a href="http://www.castor.org/">Castor</a> for more information on the mapping. </li>
            </ul>
         </p>  
         </subsection>
    </section>
   </body>
</document>
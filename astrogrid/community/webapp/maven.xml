<?xml version="1.0" encoding="UTF-8"?>

<project
    xmlns:core="jelly:core"
    xmlns:ant="jelly:ant"
    default="astrogrid-install-artifact"
    >


    <property name="webapp.docs" location="${basedir}/target/webapp-docs" />   

    <!-- ================ Reactor goals ================ -->
    <goal name="astrogrid-install-artifact" prereqs="war:install"/>
    <goal name="astrogrid-install-snapshot" prereqs="war:install-snapshot"/>
    <goal name="astrogrid-deploy-artifact"  prereqs="war:deploy"/>
    <goal name="astrogrid-deploy-snapshot"  prereqs="war:deploy-snapshot"/>
    <goal name="astrogrid-build-site"       prereqs="site"/>
    <goal name="astrogrid-deploy-site"      prereqs="site:deploy"/>
    

    <!-- ================ Component goals ================ -->

    <!--+
        | Initialise the webapp files.
        +-->
        
    <preGoal name="war:init">
        <ant:echo message=""/>
        <ant:echo message="Artifact : ${pom.artifactId}"/>
        <ant:echo message="Pre-processing for webapp task"/>
        <attainGoal name="site-webapp"/>
    </preGoal>

   <goal name="site-webapp"
           description="generate webapp docs to a temp direcotry, for inclusion later in webapp - work around for a bug that stops build">

           <echo> generating webapp site into ${webapp.docs}" </echo>
           
           <property name="tmp.docs" location="${basedir}/target/webapp-docs-src" />
           <mkdir dir="${tmp.docs}" />
           <copy overwrite="false" todir="${tmp.docs}">
             <fileset dir="${basedir}/xdocs">
             </fileset>
           </copy>
           
           <core:set var="maven.docs.dest" value="${webapp.docs}" />
           <core:set var="maven.docs.src" value="${tmp.docs}" />
           <core:set var="maven.xdoc.poweredby.title" value="Provided by Astrogrid" />
           <core:set var="maven.xdoc.poweredby.url" value="http://www.astrogrid.org" />
           <core:set var="maven.xdoc.poweredby.image" value="http://www.astrogrid.org/images/AGlogo" />
           <core:set var="maven.ui.banner.background" value="#FF0000" />
           <core:set var="maven.ui.banner.foreground" value="#000000" />
           <mkdir dir="${webapp.docs}" />

           <attainGoal name="xdoc:generate-from-pom" />
         
           <attainGoal name="xdoc" />>

   </goal>
    

</project>

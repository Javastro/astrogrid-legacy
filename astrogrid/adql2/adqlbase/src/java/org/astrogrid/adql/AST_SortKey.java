/* Generated By: AdqlStoX.jjt,v 1.28 2007/07/27 21&JJTree: Do not edit this line. AST_SortKey.java */

package org.astrogrid.adql;

import org.astrogrid.adql.beans.AtomType;
import org.astrogrid.adql.beans.ColumnReferenceType;
import org.astrogrid.adql.beans.LiteralType;
import org.astrogrid.adql.beans.StringType;
import org.astrogrid.adql.beans.IntegerType;
import org.apache.xmlbeans.XmlObject; 
import org.apache.commons.logging.Log ;
import org.apache.commons.logging.LogFactory ;

public class AST_SortKey extends SimpleNode {
    
    private static Log log = LogFactory.getLog( AST_SortKey.class ) ;

    public AST_SortKey(AdqlStoX p, int id) {
        super(p, id);
    }
  
    public void buildXmlTree( XmlObject xo ) {
        if( log.isTraceEnabled() ) enterTrace( log, "AST_SortKey.buildXmlTree()" ) ; 
            
        //
        // If it is only 1 child, it must be column name...
        if( jjtGetNumChildren() == 1 ) {
            //
            // Use a column reference to contain the name...
            children[0].buildXmlTree( xo ) ;
            this.generatedObject = this.children[0].getGeneratedObject() ;
            ColumnReferenceType crt = (ColumnReferenceType)this.generatedObject ;
            if( crt.isSetTable() | crt.isSetSchema() | crt.isSetCatalog() ) {                   
                if( !adqlstox.parser.isSyntaxSet( AdqlParser.SyntaxOption.QUALIFIED_SORT_KEYS ) ) {
                    getTracker().setError( "Sort keys in ORDER BY should be unqualified column names." ) ;            
                }
            }
        }
        //
        // Else it must be column rank order...
        // (may need to rule out 0 ???)
        else {
            AtomType orderType = (AtomType)xo.changeType( AtomType.type ) ;
            LiteralType lt = orderType.addNewLiteral() ;
            IntegerType it = (IntegerType)lt.changeType(IntegerType.type) ;
            Integer i = Integer.valueOf( this.getFirstToken().image ) ; 
            it.setValue( i.longValue() ) ;
            this.generatedObject = it ;
        }
        super.buildXmlTree( (XmlObject)this.generatedObject ) ;
        if( log.isTraceEnabled() ) exitTrace( log, "AST_SortKey.buildXmlTree()" ) ; 
    }
}

<?xml version="1.0" encoding="UTF-8"?>
<!-- $Id: deployWebapps.xml,v 1.19 2004/03/29 12:08:35 jdt Exp $ --><!--
	Example Deploy Script for Astrogrid War files
	This script uses the Tomcat Manager to deploy war files built nightly by Maven

	Note that these ant tasks require the catalina-ant.jar (found in your tomcat download) to be placed in
	your ant lib folder.  If you're running ant from Eclipse this is likely to be something like:
	C:\Java\eclipse\plugins\org.apache.ant_1.5.3
	To run it from maven, you will need to pop the catalina-ant.jar into maven's lib directory AND
	modify forehead.conf to pick it up.
	You'll need to set the urls, Tomcat Manager usernames and passwords below in the tomcatServers.xml file.
	-->
<project basedir="." default="RedeployTheLot" name="DeployWars">
  

<!--==================================================================================-->

	<target name="RedeployTheLot"
	    depends="RedeployMySpace, Redeployportal, Redeploycommunity, Redeployapplications,
	    Redeployregistry, Redeployjes, RedeployPALSimple" "/>
	<target name="DeployTheLot"
	    depends="DeployMySpace, Deployportal, Deploycommunity, Deployapplications,
	    Deployregistry, Deployjes, DeployPALSimple"  />

<!--==================================================================================-->



<!--Deployment machines see http://wiki.astrogrid.org/bin/view/Astrogrid/Itn04IREnvironment -->

  <target name="loadServersProperties">
    <xmlproperty file="tomcatServers.xml" keepRoot="false"/>
    <!-- URLs of the wars-->
    <property name="mavenURL" value="http://www.astrogrid.org/maven/"/>

    <property name="mySpace.path" value="/astrogrid-mySpace-night"/>
    <property name="mySpace.war.url" value="${mavenURL}/org.astrogrid/wars/astrogrid-mySpace-SNAPSHOT.war"/>
    <property name="mySpace.host.url" value="${servers.a.url}"/>
    <property name="mySpace.host.user" value="${servers.a.user}"/>
    <property name="mySpace.host.password" value="${servers.a.password}"/> <!-- would be nice if this could be assigned as an "array".  Might be possible in Ant 1.6...-->
  
    <property name="jes.path" value="/astrogrid-jes-night"/>   
    <property name="jes.war.url" value="${mavenURL}/org.astrogrid/wars/astrogrid-jes-SNAPSHOT.war"/>
    <property name="jes.host.url" value="${servers.a.url}"/>
    <property name="jes.host.user" value="${servers.a.user}"/>
    <property name="jes.host.password" value="${servers.a.password}"/> 
    
    <property name="palSimple.path" value="/astrogrid-pal-night"/>   
    <property name="palSimple.war.url" value="${mavenURL}/org.astrogrid/wars/pal-SNAPSHOT.war"/>
    <property name="palSimple.host.url" value="${servers.a.url}"/>
    <property name="palSimple.host.user" value="${servers.a.user}"/>
    <property name="palSimple.host.password" value="${servers.a.password}"/>
    <!--
    <property name="palSkyServer.path" value="/intTest-palSkyServer"/>   
    <property name="palSkyServer.war.url" value="${mavenURL}/org.astrogrid/wars/pal-SNAPSHOT.war"/>
    <property name="palSkyServer.host.url" value="${servers.e.url}"/>
    <property name="palSkyServer.host.user" value="${servers.e.user}"/>
    <property name="palSkyServer.host.password" value="${servers.e.password}"/>--> 
    <!--
    <property name="palMartin.path" value="/intTest-palMartin"/>   
    <property name="palMartin.war.url" value="${mavenURL}/org.astrogrid/wars/pal-SNAPSHOT.war"/>
    <property name="palMartin.host.url" value="${servers.c.url}"/>
    <property name="palMartin.host.user" value="${servers.c.user}"/>
    <property name="palMartin.host.password" value="${servers.c.password}"/> -->    

    
    <property name="applications.path" value="/astrogrid-applications-night"/>   
    <property name="applications.war.url" value="${mavenURL}/org.astrogrid/wars/astrogrid-applications-SNAPSHOT.war"/>
    <property name="applications.host.url" value="${servers.a.url}"/>
    <property name="applications.host.user" value="${servers.a.user}"/>
    <property name="applications.host.password" value="${servers.a.password}"/>
    
    <property name="community.path" value="/astrogrid-community-night"/>   
    <property name="community.war.url" value="${mavenURL}/org.astrogrid/wars/astrogrid-community-SNAPSHOT.war"/>
    <property name="community.host.url" value="${servers.a.url}"/>
    <property name="community.host.user" value="${servers.a.user}"/>
    <property name="community.host.password" value="${servers.a.password}"/>
    
    <property name="portal.path" value="/astrogrid-portal-night"/>   
    <property name="portal.war.url" value="${mavenURL}/org.astrogrid/wars/astrogrid-portal-SNAPSHOT.war"/> 
    <property name="portal.host.url" value="${servers.a.url}"/>
    <property name="portal.host.user" value="${servers.a.user}"/>
    <property name="portal.host.password" value="${servers.a.password}"/>     
        
    <property name="registry.path" value="/astrogrid-registry-night"/>   
    <property name="registry.war.url" value="${mavenURL}/org.astrogrid/wars/astrogrid-registry-SNAPSHOT.war"/>
    <property name="registry.host.url" value="${servers.c.url}"/>
    <property name="registry.host.user" value="${servers.c.user}"/>
    <property name="registry.host.password" value="${servers.c.password}"/>     
    <!--
    <property name="datawarehouse.path" value="/intTest-datawarehouse"/>   
    <property name="datawarehouse.war.url" value="${mavenURL}/org.astrogrid/wars/astrogrid-datawarehouse-SNAPSHOT.war"/>
    <property name="datawarehouse.host.url" value="${servers.c.url}"/>
    <property name="datawarehouse.host.user" value="${servers.c.user}"/>
    <property name="datawarehouse.host.password" value="${servers.c.password}"/>   -->  
     
  </target>


<!--==================================================================================-->
  <!-- community-->

    <target depends="loadServersProperties" description="Obtain the latest community war and deploy it to tomcat" name="Deploycommunity">
    	<echo message="Deploying community from ${community.war.url} to ${community.host.url} at ${community.path}"/>
		<deploy password="${community.host.password}" path="${community.path}" url="${community.host.url}" username="${community.host.user}" war="${community.war.url}"/>
    </target>
    
    <target depends="loadServersProperties" name="Undeploycommunity">
		<remove password="${community.host.password}" path="${community.path}" url="${community.host.url}" username="${community.host.user}" />
	</target>
	
    <target depends="Undeploycommunity, Deploycommunity" name="Redeploycommunity"/>

<!--==================================================================================-->

<!--==================================================================================-->
  <!-- portal-->

    <target depends="loadServersProperties" description="Obtain the latest portal war and deploy it to tomcat" name="Deployportal">
    	<echo message="Deploying portal from ${portal.war.url} to ${portal.host.url} at ${portal.path}"/>
		<deploy password="${portal.host.password}" path="${portal.path}" url="${portal.host.url}" username="${portal.host.user}" war="${portal.war.url}"/>
    </target>
    
    <target depends="loadServersProperties" name="Undeployportal">
		<remove password="${portal.host.password}" path="${portal.path}" url="${portal.host.url}" username="${portal.host.user}"/>
	</target>
	
    <target depends="Undeployportal, Deployportal" name="Redeployportal"/>

<!--==================================================================================-->

<!--==================================================================================-->
  <!-- registry-->

    <target depends="loadServersProperties" description="Obtain the latest registry war and deploy it to tomcat" name="Deployregistry">
    	<!--echo message="Deploying registry from ${registry.war.url} to ${registry.host.url} at ${registry.path}"/-->
		<!--deploy password="${registry.host.password}" path="${registry.path}" url="${registry.host.url}" username="${registry.host.user}" war="${registry.war.url}"/-->
		<echo message="Warning! Registry not automatically deployable"/>
    </target>
    
    <target depends="loadServersProperties" name="Undeployregistry">
		<!--remove password="${registry.host.password}" path="${registry.path}" url="${registry.host.url}" username="${registry.host.user}"/-->
	</target>
	
    <target depends="Undeployregistry, Deployregistry" name="Redeployregistry"/>

<!--==================================================================================-->

<!--==================================================================================-->
  <!-- datawarehouse-->

    <target depends="loadServersProperties" description="Obtain the latest datawarehouse war and deploy it to tomcat" name="Deploydatawarehouse">
    	<echo message="Deploying datawarehouse from ${datawarehouse.war.url} to ${datawarehouse.host.url} at ${datawarehouse.path}"/>
		<deploy password="${datawarehouse.host.password}" path="${datawarehouse.path}" url="${datawarehouse.host.url}" username="${datawarehouse.host.user}" war="${datawarehouse.war.url}"/>
    </target>
    
    <target depends="loadServersProperties" name="Undeploydatawarehouse">
		<remove password="${datawarehouse.host.password}" path="${datawarehouse.path}" url="${datawarehouse.host.url}" username="${datawarehouse.host.user}"/>
	</target>
	
    <target depends="Undeploydatawarehouse, Deploydatawarehouse" name="Redeploydatawarehouse"/>

<!--==================================================================================-->

<!--==================================================================================-->
  <!-- applications-->

    <target depends="loadServersProperties" description="Obtain the latest applications war and deploy it to tomcat" name="DeployApplications">
    	<echo message="Deploying applications from ${applications.war.url} to ${applications.host.url} at ${applications.path}"/>
		<deploy password="${applications.host.password}" path="${applications.path}" url="${applications.host.url}" username="${applications.host.user}" war="${applications.war.url}"/>
    </target>
    
    <target depends="loadServersProperties" name="UndeployApplications">
		<remove password="${applications.host.password}" path="${applications.path}" url="${applications.host.url}" username="${applications.host.user}"/>
	</target>
	
    <target depends="UndeployApplications, DeployApplications" name="RedeployApplications"/>

<!--==================================================================================-->

<!--==================================================================================-->
  <!-- JES-->

    <target depends="loadServersProperties" description="Obtain the latest jes war and deploy it to tomcat" name="DeployJES">
    	<echo message="Deploying JES from ${jes.war.url} to ${jes.host.url} at ${jes.path}"/>
		<deploy password="${jes.host.password}" path="${jes.path}" url="${jes.host.url}" username="${jes.host.user}" war="${jes.war.url}"/>
    </target>
    
    <target depends="loadServersProperties" name="UndeployJES">
		<remove password="${jes.host.password}" path="${jes.path}" url="${jes.host.url}" username="${jes.host.user}"/>
	</target>
	
    <target depends="UndeployJES, DeployJES" name="RedeployJES"/>

<!--==================================================================================-->

<!--==================================================================================-->
  <!-- MySpace-->

    <target depends="loadServersProperties" description="Obtain the latest MySpace war and deploy it to tomcat" name="DeployMySpace">
    	<echo message="Deploying MySpace from ${mySpace.war.url} to ${mySpace.host.url} at ${mySpace.path}"/>
		<deploy password="${mySpace.host.password}" path="${mySpace.path}" url="${mySpace.host.url}" username="${mySpace.host.user}" war="${mySpace.war.url}"/>
    </target>
    
    <target depends="loadServersProperties" name="UndeployMySpace">
		<remove password="${mySpace.host.password}" path="${mySpace.path}" url="${mySpace.host.url}" username="${mySpace.host.user}"/>
	</target>
	
    <target depends="UndeployMySpace, DeployMySpace" name="RedeployMySpace"/>

<!--==================================================================================-->

<!--==================================================================================-->
  <!-- PAL/Simple-->
  <!--An out of the box pal, just relying on its build in default "database"-->

    <target name="DeployPALSimple" depends="loadServersProperties" description="obtain latest pal war and deploy it" >
	    <echo message="Deploying PAL/Simple from ${palSimple.war.url} to ${palSimple.host.url} at ${palSimple.path}"/>
		<deploy password="${palSimple.host.password}" path="${palSimple.path}" url="${palSimple.host.url}" username="${palSimple.host.user}" war="${palSimple.war.url}"/>
    </target>
    
    <target name="UndeployPALSimple">
		<remove password="${palSimple.host.password}" 
		    path="${palSimple.path}" url="${palSimple.host.url}" username="${palSimple.host.user}"/>
	</target>
	
    <target name="RedeployPALSimple" depends="UndeployPALSimple, DeployPALSimple" />

<!--==================================================================================-->

<!--==================================================================================-->
  <!-- PAL/SkyServer-->


    <target depends="loadServersProperties" description="obtain latest pal/SkyServer war and deploy it" name="DeployPALSkyServer">
	    <echo message="Deploying PAL/SkyServer from ${palSkyServer.war.url} to ${palSkyServer.host.url} at ${palSkyServer.path}"/>
		<deploy password="${palSkyServer.host.password}" path="${palSkyServer.path}" url="${palSkyServer.host.url}" username="${palSkyServer.host.user}" war="${palSkyServer.war.url}"/>
    </target>
    
    <target name="UndeployPALSkyServer">
		<remove password="${palSkyServer.host.password}" path="${palSkyServer.path}" url="${palSkyServer.host.url}" username="${palSkyServer.host.user}"/>
	</target>
	
    <target depends="UndeployPALSkyServer, DeployPALSkyServer" name="RedeployPALSkyServer"/>

<!--==================================================================================-->

<!--==================================================================================-->
  <!-- PAL/Martin-->


    <target depends="loadServersProperties" description="obtain latest pal war and deploy it" name="DeployPalMartin">
	    <echo message="Deploying PAL/Martin from ${palMartin.war.url} to ${palMartin.host.url} at ${palMartin.path}"/>
		<deploy password="${palMartin.host.password}" path="${palMartin.path}" url="${palMartin.host.url}" username="${palMartin.host.user}" war="${palMartin.war.url}"/>
    </target>
    
    <target name="UndeployPalMartin">
		<remove password="${palMartin.host.password}" path="${palMartin.path}" url="${palMartin.host.url}" username="${palMartin.host.user}"/>
	</target>
	
    <target depends="UndeployPalMartin, DeployPalMartin" name="RedeployPalMartin"/>

<!--==================================================================================-->



  <!-- Configure the custom Ant tasks for the Manager application -->
  <taskdef classname="org.apache.catalina.ant.DeployTask" name="deploy"/>
  <taskdef classname="org.apache.catalina.ant.ListTask" name="list"/>
  <taskdef classname="org.apache.catalina.ant.ReloadTask" name="reload"/>
  <taskdef classname="org.apache.catalina.ant.ResourcesTask" name="resources"/>
  <taskdef classname="org.apache.catalina.ant.RolesTask" name="roles"/>
  <taskdef classname="org.apache.catalina.ant.StartTask" name="start"/>
  <taskdef classname="org.apache.catalina.ant.StopTask" name="stop"/>
  <taskdef classname="org.apache.catalina.ant.UndeployTask" name="undeploy"/>
  <taskdef classname="org.apache.catalina.ant.RemoveTask" name="remove"/>
</project>

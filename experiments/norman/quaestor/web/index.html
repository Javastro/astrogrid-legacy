<?xml version="1.0"?>

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>Quaestor: generic SPARQL endpoint</title>
<link rel="stylesheet"
      type="text/css"
      href="base.css"/>
</head>

<body>

<h1>Quaestor: generic SPARQL endpoint</h1>

<p>This is Quaestor version @VERSION@</p>

<p>Quaestor is a generic SPARQL endpoint, which allows you to upload
ontology and instance data (also known as `TBox' and `ABox',
respectively), and query the result.</p>

<p>You interact with Quaestor as follows.</p>
<ol>
<li>Create a `knowledgebase'.</li>
<li>Add one or more `submodels' consisting of ontology or instance data
formatted as RDF/XML or Notation3.</li>
<li>Query the knowledgebase -- the union of the submodels -- using
SPARQL.</li>
</ol>

<p>All the interaction with Quaestor is via HTTP, and the HTTP
<code>GET</code>, <code>PUT</code>, <code>POST</code> and
<code>DELETE</code> verbs.  There is also a preliminary XML-RPC
interface.</p>

<p>In the documentation below, <code>hostport</code> refers to the
machine and port number hosting the Quaestor service, such as
<code>localhost:8080</code>.</p>

<h2>HTTP-based interface</h2>

<dl>
<dt><code>GET http://hostport/quaestor/kb</code></dt>
<dd>Retrieve an information page, reporting on the knowledgebases
currently available.</dd>

<dt><code>GET http://hostport/quaestor/kb/<em>kb-name</em>[/<em>sm-name</em>]</code></dt>
<dd><p>Retrieve either the complete <code><em>kb-name</em></code> model, or
the named <code><em>sm-name</em></code> submodel.  The format of the response
is controlled by the <code>Accept</code> header, which if present must
contain one of the following MIME types (see <a href='#mimetypes'
>note</a> below):</p>
<ul>
  <li><code>text/rdf+n3</code> : Notation3 (default)</li>
  <li><code>application/xml</code> : RDF/XML serialisation</li>
  <li><code>text/plain</code> : N-triples format</li>
  <li><code>text/csv</code> : comma-separated values</li>
  <li><code>text/tab-separated-values</code></li>
  <li><code>*/*</code> to accept any format (the default is Notation3)</li>
</ul>

<p>You can add an optional query <code>?model</code> or
<code>?metadata</code> to retrieve the appropriate thing; the default
is to retrieve the model.</p>

<p>This method returns status 200 (OK) on success, or a 4xx code on
error.</p></dd>

<dt><code>GET http://hostport/quaestor/kb/<em>kb-name</em>?sparql=<em>query</em></code></dt>
<dd>Perform the SPARQL query which is URL-encoded in the string
<em>query</em>.  This has the same response codes and
<code>accept</code> headers as the <code>POST</code> method below.</dd>

<dt><code>POST http://hostport/quaestor/kb/<em>kb-name</em></code></dt>
<dd><p>Takes a SPARQL query as the request body, which should be
posted with the <code>Content-Type</code> set to
<code>application/sparql-query</code> (if there is no
<code>Content-Type</code>, then this type is assumed).  The request may be
accompanied by an <code>Accept</code> header to control the format of
the returned data; the MIME types recognised are the same as for the
GET request above.</p>

<p>Returns status 200 (OK) on success, and 4xx otherwise.</p>
</dd>

<dt><code>PUT http://hostport/quaestor/kb/<em>kb-name</em></code></dt>
<dd><p>Create a new knowledgebase named `<em>kb-name</em>'.  The
request content contains the metadata for the knowledgebase.  This can
be expressed as RDF (with MIME types <code>text/rdf+n3</code> or
<code>application/rdf+xml</code>).  For example the body might be:</p>
<pre>
@prefix dc: &lt;http://purl.org/dc/elements/1.1/&gt;.
&lt;&gt; dc:description "My knowledgebase";
    dc:creator "Norman".
</pre>
<p>Alternatively, the content can have a <code>text/plain</code> MIME
type, which in this context means that the knowledgebase will be given
a <code>dc:description</code> whose subject is the given text.</p>

<p>It is an error if the
knowledgebase already exists.  Returns status 204 (No Content) on success,
and a 4xx error message if the knowledgebase already exists or if
there is some other error.</p>
</dd>

<dt><code>PUT http://hostport/quaestor/kb/<em>kb-name</em>/<em>sm-name</em></code></dt>
<dd><p>Upload the request body as the content of the submodel named
<em>sm-name</em>.  The
request may have a <code>Content-Type</code> header indicating the
format of the body, which, if it is present, <em>must</em> be one of
the following MIME types (see <a href='#mimetypes' >note</a> below):</p>
<ul>
  <li><code>text/rdf+n3</code> : Notation3.</li>
  <li><code>application/rdf+xml</code> : RDF/XML</li>
  <li><code>text/plain</code> : N-Triples</li>
</ul>
<!-- defaults -->
<p>The request may have a <em>query</em> appended, which may be
<code>?abox</code>, <code>?instances</code> (which is equivalent to
<code>?abox</code>) or <code>?tbox</code>.  This indicates the type of
the corresponding model.  The default, if no such query is given, is
<code>tbox</code> (I'm not sure how legit this use of query is -- this
might change).</p>

<p>Notation3 may also  be uploaded using the deprecated MIME type
<code>application/n3</code>.</p>
</dd>

<dt><code>PUT http://hostport/quaestor/code</code></dt>
<dd>Eval the request body as Scheme code.  This is only possible if
the server has been configured to permit it.</dd>

<dt><code>DELETE http://hostport/quaestor/kb/<em>kb-name</em></code></dt>
<dd>Remove the named knowledgebase.  Returns status 204 (No Content)
if it successfully removed the knowledgebase, or a 4xx response if
there was no such knowledgebase to remove.</dd>

</dl>

<h2><a name='mimetypes'>Note on MIME types</a></h2>

<p>The following MIME types are usable at one point or another when
interacting with Quaestor:</p>

<dl>

<dt><code>application/rdf+xml</code></dt>
<dd>This indicates that the content (upload or response) is formatted
in the standard <a href='http://www.w3.org/TR/rdf-syntax-grammar/'
>RDF/XML</a> serialisation.</dd>

<dt><code>application/xml</code></dt>
<dd>When annotating a SPARQL response, this produces a response in
XML, using the
<a href="http://www.w3.org/TR/rdf-sparql-XMLres/" >SPARQL response XML 
schema</a>.</dd>

<dt><code>application/sparql-query</code></dt>
<dd>This is the MIME type which should accompany a POSTed SPARQL
query.  See the <a href='http://www.w3.org/TR/rdf-sparql-query/'
>specification</a> for more details.</dd>

<dt><code>text/rdf+n3</code></dt>
<dd>This indicates that the content (upload or response) is formatted in
<a href='http://www.w3.org/DesignIssues/Notation3' >Notation-3</a>.
The <code>application/n3</code> MIME type is recognised but
deprecated (see <a href='http://www.w3.org/DesignIssues/Notation3' >W3
discussion</a>), since its IANA registration was never completed;
<code>text/rdf+n3</code> is the preferred MIME type for Notation3, and
if <code>application/n3</code> is requested, it is
<code>text/rdf+n3</code> which will be returned.</dd>

<dt><code>text/plain</code></dt>
<dd><p>This MIME type means various different things in different
contexts.</p>

<p>Annotating a SPARQL response, this indicates that the content is in a
human-readable format, intended to look roughly like the usual 
result of a SQL query.  It is not intended to be
machine-parseable.</p>

<p>The MIME type of the <a
href='http://www.w3.org/TR/rdf-testcases/#ntriples' >N-triple
format</a> is also <code>text/plain</code>; however N-triple format is
intended only for the RDF test cases, and is not expected to be useful
otherwise.  When retrieving an ontology (using the <code>GET</code>
HTTP method) or uploading one (using <code>PUT</code>), you can use
<code>text/plain</code> to indicate N-triples, if you really
must.</p>
</dd>

<dt><code>text/csv</code> (SELECT query responses only)</dt>
<dd>Comma-separated-value output, conforming to RFC 4180.  The
<code>Content-Type</code> of the response is
<code>text/csv;header=present</code>, indicating that the first line
of the response consists of 'column headings', consisting of the
substitution variables in the input query.  These are not guaranteed
to be in the same order as they were listed in the input query.</dd>

<dt><code>text/tab-separated-values</code> (SELECT query responses only)</dt>
<dd>Tab-separated-value output, conforming to the (rather informal)
specification
<a href='http://www.iana.org/assignments/media-types/text/tab-separated-values'
>at IANA</a>.  The first line will include a row of 'column headings'
as above.</dd>
</dl>

<h2>XML-RPC interface</h2>

<p>The XML-RPC endpoint is <code>http://hostport/quaestor/xmlrpc</code></p>

<p>There are only two methods defined at present; more might appear
in future.</p>

<dl>
<dt><code>get-model(<em>knowledgebase</em>:string 
[,<em>submodel</em>:string])</code> : <em>URL</em></dt>
<dd>Retrieve a URL from which the client can obtain the full
knowledgebase, or just a submodel.  This is just a convenience method,
since the URL returned is just the one described in the HTTP-interface
above.</dd>

<dt><code>query-model(<em>knowledgebase</em>:string,
<em>sparql-query</em>:string
[,<em>mime-type</em>:string])</code> : <em>URL</em></dt>
<dd>Sends a SPARQL query to the server, and return a URL from which
the results can be retrieved.  Although this returns promptly, after
having done all required checking and parsing, the query is not
actually run until the returned URL is dereferenced.</dd>
</dl>

<h3>XML-RPC fault codes</h3>
<dl>
<dt>0</dt>
<dd>Protocol error, such as mangled XML, or invalid
request headers</dd>

<dt>1</dt>
<dd>Unrecognised method</dd>

<dt>2</dt>
<dd>Malformed request: the method was syntactically valid and
intelligible, but had the wrong number or type of arguments</dd>

<dt>10</dt>
<dd>get-model, query-model: Unknown object requested, either an invalid
knowledgebase or submodel</dd>

<dt>20</dt>
<dd>query-model: bad query, either unparseable SPARQL or an
unsupported MIME type</dd>
</dl>

<h2>Links</h2>

<p>References to specifications and further information.</p>

<ul>
  <li><a href="http://www.w3.org/TR/rdf-sparql-query/" >SPARQL query
  spec</a></li>
  <li>The SPARQL XML response is described at <a
  href="http://www.w3.org/TR/rdf-sparql-XMLres/"
  ><code>http://www.w3.org/TR/rdf-sparql-XMLres/</code></a>, with
  fuller notes on the <a
  href="http://www.w3.org/2001/sw/DataAccess/prot26" >SPARQL service
  interface</a> elsewhere.</li>
  <li>XML-RPC <a href="http://www.xmlrpc.com/">home</a></li>
  <li><a href='http://www.w3.org/DesignIssues/Notation3'
    >Notation 3 spec</a></li>
  <li>The HTTP protocol is defined in
    <a href='http://www.ietf.org/rfc/rfc2616.txt' >RFC 2616</a></li>
</ul>

</body>
</html>
